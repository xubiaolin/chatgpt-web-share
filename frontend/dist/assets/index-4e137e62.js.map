{"version":3,"file":"index-4e137e62.js","sources":["../../src/views/login/index.vue"],"sourcesContent":["<template>\n  <!-- Login Form -->\n  <div class=\"flex justify-center items-center mt-20\">\n    <n-form\n      ref=\"formRef\"\n      :model=\"formValue\"\n      :rules=\"loginRules\"\n      :label-col=\"{ span: 8 }\"\n      :wrapper-col=\"{ span: 16 }\"\n    >\n      <n-form-item\n        :label=\"$t('commons.username')\"\n        path=\"username\"\n      >\n        <n-input\n          v-model:value=\"formValue.username\"\n          :placeholder=\"$t('tips.pleaseEnterUsername')\"\n          :input-props=\"{\n            autoComplete: 'username',\n          }\"\n        />\n      </n-form-item>\n      <n-form-item\n        :label=\"$t('commons.password')\"\n        path=\"password\"\n      >\n        <n-input\n          v-model:value=\"formValue.password\"\n          type=\"password\"\n          show-password-on=\"click\"\n          :placeholder=\"$t('tips.pleaseEnterPassword')\"\n          :input-props=\"{\n            autoComplete: 'current-password',\n          }\"\n          @keyup.enter=\"login\"\n        />\n      </n-form-item>\n      <n-form-item wrapper-col=\"{ span: 16, offset: 8 }\">\n        <n-button\n          type=\"primary\"\n          :enabled=\"loading\"\n          @click=\"login\"\n        >\n          {{ $t('commons.login') }}\n        </n-button>\n      </n-form-item>\n    </n-form>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { FormInst } from 'naive-ui';\nimport { FormValidationError } from 'naive-ui/es/form';\nimport { reactive,ref } from 'vue';\nimport { useI18n } from 'vue-i18n';\nimport { useRouter } from 'vue-router';\n\nimport { loginApi, LoginData } from '@/api/user';\nimport { useUserStore } from '@/store';\nimport { Message } from '@/utils/tips';\n\nconst router = useRouter();\nconst { t } = useI18n();\nconst userStore = useUserStore();\nconst formRef = ref<FormInst>();\n\nconst formValue = reactive({\n  username: '',\n  password: '',\n});\nconst loading = ref(false);\nconst loginRules = {\n  username: { required: true, message: t('tips.pleaseEnterUsername'), trigger: 'blur' },\n  password: { required: true, message: t('tips.pleaseEnterPassword'), trigger: 'blur' },\n};\n\nconst login = async () => {\n  if (loading.value) return;\n  formRef.value\n    ?.validate((errors?: Array<FormValidationError>) => {\n      if (!errors) {\n        loading.value = true;\n      }\n    })\n    .then(async () => {\n      try {\n        await userStore.login(formValue as LoginData);\n        const { redirect, ...othersQuery } = router.currentRoute.value.query;\n        await userStore.fetchUserInfo();\n        Message.success(t('tips.loginSuccess'));\n        await router.push({\n          name: userStore.user?.is_superuser ? 'admin' : 'conversation',\n        });\n        // TODO: 记住密码\n      } catch (error) {\n        console.log(error);\n      } finally {\n        loading.value = false;\n      }\n    });\n};\n\nif (userStore.user) {\n  router.push({ name: 'conversation' });\n}\n</script>\n"],"names":["router","useRouter","t","useI18n","userStore","useUserStore","formRef","ref","formValue","reactive","loading","loginRules","login","_a","errors","redirect","othersQuery","Message","error"],"mappings":"0TA6DA,MAAAA,EAAAC,IACA,CAAA,EAAAC,GAAAC,IACAC,EAAAC,IACAC,EAAAC,IAEAC,EAAAC,EAAA,CAA2B,SAAA,GACf,SAAA,EACA,CAAA,EAEZC,EAAAH,EAAA,EAAA,EACAI,EAAA,CAAmB,SAAA,CAAA,SAAA,GAAA,QAAAT,EAAA,0BAAA,EAAA,QAAA,MAAA,EACmE,SAAA,CAAA,SAAA,GAAA,QAAAA,EAAA,0BAAA,EAAA,QAAA,MAAA,CACA,EAGtFU,EAAA,SAAA,OACEF,EAAA,QACAG,EAAAP,EAAA,QAAA,MAAAO,EAAA,SAAAC,GAAA,CAEIA,IACEJ,EAAA,MAAA,GACF,GAAA,KAAA,SAAA,OAGA,GAAA,CACE,MAAAN,EAAA,MAAAI,CAAA,EACA,KAAA,CAAA,SAAAO,EAAA,GAAAC,CAAA,EAAAhB,EAAA,aAAA,MAAA,MACA,MAAAI,EAAA,gBACAa,EAAA,QAAAf,EAAA,mBAAA,CAAA,EACA,MAAAF,EAAA,KAAA,CAAkB,MAAAa,EAAAT,EAAA,OAAA,MAAAS,EAAA,aAAA,QAAA,cAC+B,CAAA,CAChD,OAAAK,EAAA,CAGD,QAAA,IAAAA,CAAA,CAAiB,QAAA,CAEjBR,EAAA,MAAA,EAAgB,CAClB,EACD,EAGL,OAAAN,EAAA,MACEJ,EAAA,KAAA,CAAA,KAAA,cAAA,CAAA"}