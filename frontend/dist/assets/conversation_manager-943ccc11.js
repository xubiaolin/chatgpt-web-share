import{d as P,P as U,Q as b,R as f,r as A,e as I,S as D,G as s,Y as R,a0 as M,l as x,V as a,U as r,k as j,z as E,c as g,X as C}from"./vue-aaa0e4fd.js";import{n as H,j as K,g as L,x as O,c as w,m as d,y as G,z as Q,B as z,C as X}from"./index-39327448.js";import{M as Y,v as N,N as _,L as Z,a as T}from"./naive_ui-66407851.js";import{R as q}from"./RefreshFilled-8fe6b2d2.js";import{T as J}from"./TrashOutline-6dc727ad.js";const W={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},ee=f("path",{d:"M14 9l-1-2H7V5.72c.6-.34 1-.98 1-1.72c0-1.1-.9-2-2-2s-2 .9-2 2c0 .74.4 1.38 1 1.72V21h2v-4h5l1 2h7V9h-6zm4 8h-4l-1-2H7V9h5l1 2h5v6z",fill:"currentColor"},null,-1),te=[ee],ne=P({name:"EmojiFlagsFilled",render:function(t,h){return U(),b("svg",W,te)}}),oe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},se=f("path",{d:"M13 8c0-2.21-1.79-4-4-4S5 5.79 5 8s1.79 4 4 4s4-1.79 4-4zm2 2v2h3v3h2v-3h3v-2h-3V7h-2v3h-3zM1 18v2h16v-2c0-2.66-5.33-4-8-4s-8 1.34-8 4z",fill:"currentColor"},null,-1),ae=[se],ie=P({name:"PersonAddAlt1Filled",render:function(t,h){return U(),b("svg",oe,ae)}}),re=P({__name:"UserSelector",emits:["update:value"],setup(S,{emit:t}){const h=H.global.t,v=A([]),y=A(null),l=m=>!0,u=m=>{t("update:value",m)};K().then(m=>{v.value=m.data});const $=I(()=>v.value.map(m=>({label:m.username,value:m.username})));return(m,k)=>{const V=Y;return U(),D(V,{value:y.value,"onUpdate:value":[k[0]||(k[0]=F=>y.value=F),u],"get-show":l,options:s($),placeholder:s(h)("commons.chooseUser")},null,8,["value","options","placeholder"])}}}),le={class:"mb-4 mt-1 ml-1 flex flex-row justify-between space-x-2"},ce={class:"flex flex-row space-x-4"},de={class:"space-x-2"},me={class:"space-x-2"},he=P({__name:"conversation_manager",setup(S){const{t}=R(),h=M(),v=A([]),y=e=>e.conversation_id,l=A([]),u=()=>{O(!0).then(e=>{v.value=e.data})};u();const $=[{type:"selection"},{title:"#",key:"id",sorter:"default"},{title:"UUID",key:"conversation_id",render:e=>x(N,{trigger:"hover"},{trigger:()=>{var n;return(n=e.conversation_id)==null?void 0:n.substring(0,4)},default:()=>e.conversation_id})},{title:t("commons.title"),key:"title",sorter:"default",render:e=>x(_,{text:!0,tag:"a",href:h.resolve({name:"conversationHistory",params:{conversation_id:e.conversation_id}}).href,target:"_blank"},{default:()=>e.title?e.title:t("commons.empty")})},{title:t("commons.belongToUser"),key:"user_id",render:e=>e.user_id?e.user_id:t("commons.empty"),sorter:"default"},{title:t("commons.createTime"),key:"create_time",defaultSortOrder:"descend",sorter:(e,n)=>!e.create_time||!n.create_time?0:new Date(e.create_time).getTime()-new Date(n.create_time).getTime(),render:e=>e.create_time?x(N,{trigger:"hover"},{trigger:()=>new Date(e.create_time+"Z").toLocaleString(),default:()=>e.create_time}):""},{title:t("commons.modelName"),key:"model_name",render(e){return e.model_name?L(e.model_name):t("commons.unknown")},sorter:"default"},{title:t("commons.isValid"),key:"is_valid",render(e){return e.is_valid?t("commons.yes"):t("commons.no")},sorter:(e,n)=>{const o=e.is_valid?1:0,i=n.is_valid?1:0;return o-i}}],m=()=>{const e=w.info({title:t("commons.invalidateConversation"),content:t("tips.invalidateConversation"),positiveText:t("commons.confirm"),negativeText:t("commons.cancel"),onPositiveClick:()=>(e.loading=!0,new Promise((n,o)=>{(async()=>{for(const c of l.value)await Q(c)})().then(()=>{d.success(t("tips.deleteConversationSuccess")),u(),n(!0)}).catch(c=>{d.error(t("tips.deleteConversationFailed")+": "+c),o(c)}).finally(()=>{e.loading=!1})}))})},k=()=>{const e=w.warning({title:t("commons.vanishConversation"),content:t("tips.vanishConversation"),positiveText:t("commons.confirm"),negativeText:t("commons.cancel"),onPositiveClick:()=>(e.loading=!0,new Promise((n,o)=>{(async()=>{for(const c of l.value)await z(c),await new Promise(p=>setTimeout(p,200))})().then(()=>{d.success(t("tips.success")),u(),l.value=[],n(!0)}).catch(c=>{d.error(t("tips.failed")+": "+c),o(c)}).finally(()=>{e.loading=!1})}))})},V=()=>{let e=null;const n=w.warning({title:t("commons.chooseUserToAssign"),content:()=>x(re,{"onUpdate:value":o=>{e=o}}),positiveText:t("commons.confirm"),negativeText:t("commons.cancel"),onPositiveClick:()=>(n.loading=!0,new Promise((o,i)=>{if(e===null){d.error(t("errors.noUserSelected")),n.loading=!1,i(!1);return}(async()=>{for(const p of l.value)await X(p,e)})().then(()=>{d.success(t("tips.success")),u(),l.value=[],o(!0)}).catch(p=>{d.error(t("tips.failed")+": "+p),i(p)}).finally(()=>{n.loading=!1})}))})},F=()=>{const e=w.info({title:t("commons.deleteInvalidConversations"),content:t("commons.deleteInvalidConversationsConfirm"),positiveText:t("commons.confirm"),negativeText:t("commons.cancel"),onPositiveClick:()=>{e.loading=!0;const n=async()=>{for(const o of v.value)o.is_valid||(await z(o.conversation_id),await new Promise(i=>setTimeout(i,200)));v.value=v.value.filter(o=>o.is_valid)};return new Promise((o,i)=>{n().then(()=>{d.success(t("tips.deleteConversationSuccess")),u(),l.value=[],o(!0)}).catch(c=>{d.error(t("tips.deleteConversationFailed")),i()}).finally(()=>{e.loading=!1})})}})},B=()=>{const e=w.error({title:t("commons.clearAllConversations"),content:t("commons.readyToClearAllConversations"),positiveText:t("commons.confirm"),negativeText:t("commons.cancel"),onPositiveClick:()=>(e.loading=!0,new Promise((n,o)=>{G().then(()=>{d.success(t("tips.deleteConversationSuccess")),u(),l.value=[],n(!0)}).catch(i=>{d.error(t("tips.deleteConversationFailed")),o()}).finally(()=>{e.loading=!1})}))})};return(e,n)=>{const o=Z;return U(),b("div",null,[f("div",le,[f("div",ce,[a(s(_),{circle:"",onClick:u},{icon:r(()=>[a(s(T),null,{default:r(()=>[a(s(q))]),_:1})]),_:1}),j(f("div",de,[a(s(_),{type:"warning",secondary:"",onClick:m},{icon:r(()=>[a(s(T),null,{default:r(()=>[a(s(ne))]),_:1})]),default:r(()=>[g(" "+C(e.$t("commons.invalidateConversation")),1)]),_:1}),a(s(_),{type:"error",secondary:"",onClick:k},{icon:r(()=>[a(s(T),null,{default:r(()=>[a(s(J))]),_:1})]),default:r(()=>[g(" "+C(e.$t("commons.vanishConversation")),1)]),_:1}),a(s(_),{type:"info",secondary:"",onClick:V},{icon:r(()=>[a(s(T),null,{default:r(()=>[a(s(ie))]),_:1})]),default:r(()=>[g(" "+C(e.$t("commons.chooseUserToAssign")),1)]),_:1})],512),[[E,l.value.length!==0]])]),f("div",me,[a(s(_),{onClick:F},{default:r(()=>[g(C(e.$t("commons.deleteInvalidConversations")),1)]),_:1}),a(s(_),{type:"error",onClick:B},{default:r(()=>[g(C(e.$t("commons.clearAllConversations")),1)]),_:1})])]),a(o,{"checked-row-keys":l.value,"onUpdate:checkedRowKeys":n[0]||(n[0]=i=>l.value=i),size:"small",columns:$,data:v.value,bordered:!0,pagination:{pageSize:20},"row-key":y},null,8,["checked-row-keys","data"])])}}});export{he as default};
//# sourceMappingURL=conversation_manager-943ccc11.js.map
