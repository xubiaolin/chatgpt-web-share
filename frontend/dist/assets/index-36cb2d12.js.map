{"version":3,"file":"index-36cb2d12.js","sources":["../../node_modules/.pnpm/@vicons+ionicons5@0.12.0/node_modules/@vicons/ionicons5/es/Add.js","../../node_modules/.pnpm/@vicons+ionicons5@0.12.0/node_modules/@vicons/ionicons5/es/ArrowDown.js","../../node_modules/.pnpm/@vicons+ionicons5@0.12.0/node_modules/@vicons/ionicons5/es/ChatboxEllipses.js","../../node_modules/.pnpm/@vicons+ionicons5@0.12.0/node_modules/@vicons/ionicons5/es/LogoMarkdown.js","../../node_modules/.pnpm/@vicons+ionicons5@0.12.0/node_modules/@vicons/ionicons5/es/Print.js","../../node_modules/.pnpm/@vicons+ionicons5@0.12.0/node_modules/@vicons/ionicons5/es/Send.js","../../node_modules/.pnpm/@vicons+ionicons5@0.12.0/node_modules/@vicons/ionicons5/es/Stop.js","../../node_modules/.pnpm/@vicons+material@0.12.0/node_modules/@vicons/material/es/EventBusyFilled.js","../../node_modules/.pnpm/@vicons+material@0.12.0/node_modules/@vicons/material/es/FullscreenRound.js","../../node_modules/.pnpm/@vicons+material@0.12.0/node_modules/@vicons/material/es/KeyboardDoubleArrowDownRound.js","../../node_modules/.pnpm/@vicons+material@0.12.0/node_modules/@vicons/material/es/KeyboardDoubleArrowUpRound.js","../../node_modules/.pnpm/@vicons+material@0.12.0/node_modules/@vicons/material/es/MenuRound.js","../../node_modules/.pnpm/@vicons+material@0.12.0/node_modules/@vicons/material/es/QueueFilled.js","../../src/views/conversation/components/InputRegion.vue","../../src/views/conversation/components/StatusCard.vue","../../src/views/conversation/components/LeftBar.vue","../../node_modules/.pnpm/file-saver@2.0.5/node_modules/file-saver/dist/FileSaver.min.js","../../src/views/conversation/utils/export.ts","../../src/views/conversation/index.vue"],"sourcesContent":["import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, defineComponent } from 'vue'\nconst _hoisted_1 = {\n  xmlns: 'http://www.w3.org/2000/svg',\n  'xmlns:xlink': 'http://www.w3.org/1999/xlink',\n  viewBox: '0 0 512 512'\n}\nconst _hoisted_2 = /*#__PURE__*/ _createElementVNode(\n  'path',\n  {\n    fill: 'none',\n    stroke: 'currentColor',\n    'stroke-linecap': 'round',\n    'stroke-linejoin': 'round',\n    'stroke-width': '32',\n    d: 'M256 112v288'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nconst _hoisted_3 = /*#__PURE__*/ _createElementVNode(\n  'path',\n  {\n    fill: 'none',\n    stroke: 'currentColor',\n    'stroke-linecap': 'round',\n    'stroke-linejoin': 'round',\n    'stroke-width': '32',\n    d: 'M400 256H112'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nconst _hoisted_4 = [_hoisted_2, _hoisted_3]\nexport default defineComponent({\n  name: 'Add',\n  render: function render(_ctx, _cache) {\n    return _openBlock(), _createElementBlock('svg', _hoisted_1, _hoisted_4)\n  }\n})\n","import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, defineComponent } from 'vue'\nconst _hoisted_1 = {\n  xmlns: 'http://www.w3.org/2000/svg',\n  'xmlns:xlink': 'http://www.w3.org/1999/xlink',\n  viewBox: '0 0 512 512'\n}\nconst _hoisted_2 = /*#__PURE__*/ _createElementVNode(\n  'path',\n  {\n    fill: 'none',\n    stroke: 'currentColor',\n    'stroke-linecap': 'round',\n    'stroke-linejoin': 'round',\n    'stroke-width': '48',\n    d: 'M112 268l144 144l144-144'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nconst _hoisted_3 = /*#__PURE__*/ _createElementVNode(\n  'path',\n  {\n    fill: 'none',\n    stroke: 'currentColor',\n    'stroke-linecap': 'round',\n    'stroke-linejoin': 'round',\n    'stroke-width': '48',\n    d: 'M256 392V100'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nconst _hoisted_4 = [_hoisted_2, _hoisted_3]\nexport default defineComponent({\n  name: 'ArrowDown',\n  render: function render(_ctx, _cache) {\n    return _openBlock(), _createElementBlock('svg', _hoisted_1, _hoisted_4)\n  }\n})\n","import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, defineComponent } from 'vue'\nconst _hoisted_1 = {\n  xmlns: 'http://www.w3.org/2000/svg',\n  'xmlns:xlink': 'http://www.w3.org/1999/xlink',\n  viewBox: '0 0 512 512'\n}\nconst _hoisted_2 = /*#__PURE__*/ _createElementVNode(\n  'path',\n  {\n    d: 'M408 48H104a72.08 72.08 0 0 0-72 72v192a72.08 72.08 0 0 0 72 72h24v64a16 16 0 0 0 26.25 12.29L245.74 384H408a72.08 72.08 0 0 0 72-72V120a72.08 72.08 0 0 0-72-72zM160 248a32 32 0 1 1 32-32a32 32 0 0 1-32 32zm96 0a32 32 0 1 1 32-32a32 32 0 0 1-32 32zm96 0a32 32 0 1 1 32-32a32 32 0 0 1-32 32z',\n    fill: 'currentColor'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nconst _hoisted_3 = [_hoisted_2]\nexport default defineComponent({\n  name: 'ChatboxEllipses',\n  render: function render(_ctx, _cache) {\n    return _openBlock(), _createElementBlock('svg', _hoisted_1, _hoisted_3)\n  }\n})\n","import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, defineComponent } from 'vue'\nconst _hoisted_1 = {\n  xmlns: 'http://www.w3.org/2000/svg',\n  'xmlns:xlink': 'http://www.w3.org/1999/xlink',\n  viewBox: '0 0 512 512'\n}\nconst _hoisted_2 = /*#__PURE__*/ _createElementVNode(\n  'path',\n  {\n    d: 'M475 64H37C16.58 64 0 81.38 0 102.77v306.42C0 430.59 16.58 448 37 448h438c20.38 0 37-17.41 37-38.81V102.77C512 81.38 495.42 64 475 64zM288 368h-64V256l-48 64l-48-64v112H64V144h64l48 80l48-80h64zm96 0l-80-112h48.05L352 144h64v112h48z',\n    fill: 'currentColor'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nconst _hoisted_3 = [_hoisted_2]\nexport default defineComponent({\n  name: 'LogoMarkdown',\n  render: function render(_ctx, _cache) {\n    return _openBlock(), _createElementBlock('svg', _hoisted_1, _hoisted_3)\n  }\n})\n","import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, defineComponent } from 'vue'\nconst _hoisted_1 = {\n  xmlns: 'http://www.w3.org/2000/svg',\n  'xmlns:xlink': 'http://www.w3.org/1999/xlink',\n  viewBox: '0 0 512 512'\n}\nconst _hoisted_2 = /*#__PURE__*/ _createElementVNode(\n  'path',\n  {\n    d: 'M408 112H106a58 58 0 0 0-58 58v158a56 56 0 0 0 56 56h8v39.68A40.32 40.32 0 0 0 152.32 464h207.36A40.32 40.32 0 0 0 400 423.68V384h8a56 56 0 0 0 56-56V168a56 56 0 0 0-56-56zm-40 311.68a8.35 8.35 0 0 1-8.32 8.32H152.32a8.35 8.35 0 0 1-8.32-8.32V264.32a8.35 8.35 0 0 1 8.32-8.32h207.36a8.35 8.35 0 0 1 8.32 8.32zm26-215.76a24 24 0 1 1 22-22a24 24 0 0 1-22 22z',\n    fill: 'currentColor'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nconst _hoisted_3 = /*#__PURE__*/ _createElementVNode(\n  'path',\n  {\n    d: 'M344 48H168a56.09 56.09 0 0 0-55.42 48h286.84A56.09 56.09 0 0 0 344 48z',\n    fill: 'currentColor'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nconst _hoisted_4 = [_hoisted_2, _hoisted_3]\nexport default defineComponent({\n  name: 'Print',\n  render: function render(_ctx, _cache) {\n    return _openBlock(), _createElementBlock('svg', _hoisted_1, _hoisted_4)\n  }\n})\n","import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, defineComponent } from 'vue'\nconst _hoisted_1 = {\n  xmlns: 'http://www.w3.org/2000/svg',\n  'xmlns:xlink': 'http://www.w3.org/1999/xlink',\n  viewBox: '0 0 512 512'\n}\nconst _hoisted_2 = /*#__PURE__*/ _createElementVNode(\n  'path',\n  {\n    d: 'M476.59 227.05l-.16-.07L49.35 49.84A23.56 23.56 0 0 0 27.14 52A24.65 24.65 0 0 0 16 72.59v113.29a24 24 0 0 0 19.52 23.57l232.93 43.07a4 4 0 0 1 0 7.86L35.53 303.45A24 24 0 0 0 16 327v113.31A23.57 23.57 0 0 0 26.59 460a23.94 23.94 0 0 0 13.22 4a24.55 24.55 0 0 0 9.52-1.93L476.4 285.94l.19-.09a32 32 0 0 0 0-58.8z',\n    fill: 'currentColor'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nconst _hoisted_3 = [_hoisted_2]\nexport default defineComponent({\n  name: 'Send',\n  render: function render(_ctx, _cache) {\n    return _openBlock(), _createElementBlock('svg', _hoisted_1, _hoisted_3)\n  }\n})\n","import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, defineComponent } from 'vue'\nconst _hoisted_1 = {\n  xmlns: 'http://www.w3.org/2000/svg',\n  'xmlns:xlink': 'http://www.w3.org/1999/xlink',\n  viewBox: '0 0 512 512'\n}\nconst _hoisted_2 = /*#__PURE__*/ _createElementVNode(\n  'path',\n  {\n    d: 'M392 432H120a40 40 0 0 1-40-40V120a40 40 0 0 1 40-40h272a40 40 0 0 1 40 40v272a40 40 0 0 1-40 40z',\n    fill: 'currentColor'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nconst _hoisted_3 = [_hoisted_2]\nexport default defineComponent({\n  name: 'Stop',\n  render: function render(_ctx, _cache) {\n    return _openBlock(), _createElementBlock('svg', _hoisted_1, _hoisted_3)\n  }\n})\n","import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, defineComponent } from 'vue'\nconst _hoisted_1 = {\n  xmlns: 'http://www.w3.org/2000/svg',\n  'xmlns:xlink': 'http://www.w3.org/1999/xlink',\n  viewBox: '0 0 24 24'\n}\nconst _hoisted_2 = /*#__PURE__*/ _createElementVNode(\n  'path',\n  {\n    d: 'M9.31 17l2.44-2.44L14.19 17l1.06-1.06l-2.44-2.44l2.44-2.44L14.19 10l-2.44 2.44L9.31 10l-1.06 1.06l2.44 2.44l-2.44 2.44L9.31 17zM19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z',\n    fill: 'currentColor'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nconst _hoisted_3 = [_hoisted_2]\nexport default defineComponent({\n  name: 'EventBusyFilled',\n  render: function render(_ctx, _cache) {\n    return _openBlock(), _createElementBlock('svg', _hoisted_1, _hoisted_3)\n  }\n})\n","import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, defineComponent } from 'vue'\nconst _hoisted_1 = {\n  xmlns: 'http://www.w3.org/2000/svg',\n  'xmlns:xlink': 'http://www.w3.org/1999/xlink',\n  viewBox: '0 0 24 24'\n}\nconst _hoisted_2 = /*#__PURE__*/ _createElementVNode(\n  'path',\n  {\n    d: 'M6 14c-.55 0-1 .45-1 1v3c0 .55.45 1 1 1h3c.55 0 1-.45 1-1s-.45-1-1-1H7v-2c0-.55-.45-1-1-1zm0-4c.55 0 1-.45 1-1V7h2c.55 0 1-.45 1-1s-.45-1-1-1H6c-.55 0-1 .45-1 1v3c0 .55.45 1 1 1zm11 7h-2c-.55 0-1 .45-1 1s.45 1 1 1h3c.55 0 1-.45 1-1v-3c0-.55-.45-1-1-1s-1 .45-1 1v2zM14 6c0 .55.45 1 1 1h2v2c0 .55.45 1 1 1s1-.45 1-1V6c0-.55-.45-1-1-1h-3c-.55 0-1 .45-1 1z',\n    fill: 'currentColor'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nconst _hoisted_3 = [_hoisted_2]\nexport default defineComponent({\n  name: 'FullscreenRound',\n  render: function render(_ctx, _cache) {\n    return _openBlock(), _createElementBlock('svg', _hoisted_1, _hoisted_3)\n  }\n})\n","import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, defineComponent } from 'vue'\nconst _hoisted_1 = {\n  xmlns: 'http://www.w3.org/2000/svg',\n  'xmlns:xlink': 'http://www.w3.org/1999/xlink',\n  viewBox: '0 0 24 24'\n}\nconst _hoisted_2 = /*#__PURE__*/ _createElementVNode(\n  'path',\n  {\n    d: 'M17.29 5.71a.996.996 0 0 0-1.41 0L12 9.58L8.11 5.7A.996.996 0 1 0 6.7 7.11l4.59 4.59c.39.39 1.02.39 1.41 0l4.59-4.59a.984.984 0 0 0 0-1.4z',\n    fill: 'currentColor'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nconst _hoisted_3 = /*#__PURE__*/ _createElementVNode(\n  'path',\n  {\n    d: 'M17.29 12.3a.996.996 0 0 0-1.41 0L12 16.17l-3.88-3.88a.996.996 0 1 0-1.41 1.41l4.59 4.59c.39.39 1.02.39 1.41 0l4.59-4.59a.993.993 0 0 0-.01-1.4z',\n    fill: 'currentColor'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nconst _hoisted_4 = [_hoisted_2, _hoisted_3]\nexport default defineComponent({\n  name: 'KeyboardDoubleArrowDownRound',\n  render: function render(_ctx, _cache) {\n    return _openBlock(), _createElementBlock('svg', _hoisted_1, _hoisted_4)\n  }\n})\n","import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, defineComponent } from 'vue'\nconst _hoisted_1 = {\n  xmlns: 'http://www.w3.org/2000/svg',\n  'xmlns:xlink': 'http://www.w3.org/1999/xlink',\n  viewBox: '0 0 24 24'\n}\nconst _hoisted_2 = /*#__PURE__*/ _createElementVNode(\n  'path',\n  {\n    d: 'M6.7 18.29c.39.39 1.02.39 1.41 0L12 14.42l3.88 3.88a.996.996 0 1 0 1.41-1.41L12.7 12.3a.996.996 0 0 0-1.41 0L6.7 16.88a.996.996 0 0 0 0 1.41z',\n    fill: 'currentColor'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nconst _hoisted_3 = /*#__PURE__*/ _createElementVNode(\n  'path',\n  {\n    d: 'M6.7 11.7c.39.39 1.02.39 1.41 0L12 7.83l3.88 3.88a.996.996 0 1 0 1.41-1.41L12.7 5.71a.996.996 0 0 0-1.41 0L6.7 10.29a.996.996 0 0 0 0 1.41z',\n    fill: 'currentColor'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nconst _hoisted_4 = [_hoisted_2, _hoisted_3]\nexport default defineComponent({\n  name: 'KeyboardDoubleArrowUpRound',\n  render: function render(_ctx, _cache) {\n    return _openBlock(), _createElementBlock('svg', _hoisted_1, _hoisted_4)\n  }\n})\n","import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, defineComponent } from 'vue'\nconst _hoisted_1 = {\n  xmlns: 'http://www.w3.org/2000/svg',\n  'xmlns:xlink': 'http://www.w3.org/1999/xlink',\n  viewBox: '0 0 24 24'\n}\nconst _hoisted_2 = /*#__PURE__*/ _createElementVNode(\n  'path',\n  {\n    d: 'M4 18h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1zm0-5h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1zM3 7c0 .55.45 1 1 1h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1z',\n    fill: 'currentColor'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nconst _hoisted_3 = [_hoisted_2]\nexport default defineComponent({\n  name: 'MenuRound',\n  render: function render(_ctx, _cache) {\n    return _openBlock(), _createElementBlock('svg', _hoisted_1, _hoisted_3)\n  }\n})\n","import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, defineComponent } from 'vue'\nconst _hoisted_1 = {\n  xmlns: 'http://www.w3.org/2000/svg',\n  'xmlns:xlink': 'http://www.w3.org/1999/xlink',\n  viewBox: '0 0 24 24'\n}\nconst _hoisted_2 = /*#__PURE__*/ _createElementVNode(\n  'path',\n  {\n    d: 'M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 9h-4v4h-2v-4H9V9h4V5h2v4h4v2z',\n    fill: 'currentColor'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nconst _hoisted_3 = [_hoisted_2]\nexport default defineComponent({\n  name: 'QueueFilled',\n  render: function render(_ctx, _cache) {\n    return _openBlock(), _createElementBlock('svg', _hoisted_1, _hoisted_3)\n  }\n})\n","<template>\n  <div\n    class=\"flex-shrink-0 flex flex-col align-middle relative z-10\"\n    :style=\"{ background: themeVars.baseColor }\"\n  >\n    <n-divider />\n    <!-- 暂停按钮 -->\n    <div class=\"flex w-full justify-center absolute -top-10\">\n      <n-button\n        v-show=\"canAbort\"\n        secondary\n        strong\n        type=\"error\"\n        size=\"small\"\n        @click=\"emits('abort-request')\"\n      >\n        <template #icon>\n          <Stop />\n        </template>\n        {{ t('commons.abortRequest') }}\n      </n-button>\n    </div>\n\n    <!-- 工具栏 -->\n    <div class=\"mx-2 flex flex-row space-x-2 py-2 justify-center relative\">\n      <!-- 展开/收起按钮 -->\n      <n-button\n        class=\"absolute left-0 top-2\"\n        quaternary\n        circle\n        size=\"small\"\n        @click=\"toggleInputExpanded\"\n      >\n        <template #icon>\n          <n-icon :component=\"inputExpanded ? KeyboardDoubleArrowDownRound : KeyboardDoubleArrowUpRound\" />\n        </template>\n      </n-button>\n      <!-- 是否启用自动滚动 -->\n      <n-tooltip>\n        <template #trigger>\n          <n-switch\n            v-model:value=\"autoScrolling\"\n            size=\"small\"\n            class=\"absolute right-2 top-3\"\n          >\n            <template #icon>\n              A\n            </template>\n          </n-switch>\n        </template>\n        {{ $t('tips.autoScrolling') }}\n      </n-tooltip>\n      <n-button\n        secondary\n        type=\"info\"\n        size=\"small\"\n        @click=\"emits('show-fullscreen-history')\"\n      >\n        <template #icon>\n          <n-icon :size=\"22\">\n            <FullscreenRound />\n          </n-icon>\n        </template>\n      </n-button>\n      <n-button\n        secondary\n        type=\"primary\"\n        size=\"small\"\n        @click=\"emits('export-to-markdown-file')\"\n      >\n        <template #icon>\n          <n-icon>\n            <LogoMarkdown />\n          </n-icon>\n        </template>\n      </n-button>\n      <n-button\n        secondary\n        type=\"warning\"\n        size=\"small\"\n        @click=\"emits('export-to-pdf-file')\"\n      >\n        <template #icon>\n          <n-icon>\n            <Print />\n          </n-icon>\n        </template>\n      </n-button>\n    </div>\n    <!-- 输入框 -->\n    <div class=\"mx-4 mb-4 flex flex-row space-x-2\">\n      <n-input\n        ref=\"inputRef\"\n        v-model:value=\"inputValue\"\n        class=\"flex-1\"\n        type=\"textarea\"\n        :bordered=\"true\"\n        :placeholder=\"$t('tips.sendMessage', [appStore.preference.sendKey])\"\n        :autosize=\"{ minRows: 1 }\"\n        :style=\"inputStyle\"\n        @keydown=\"shortcutSendMsg\"\n      >\n        <template #suffix>\n          <n-button\n            :disabled=\"sendDisabled\"\n            text\n            class=\"\"\n            type=\"primary\"\n            size=\"small\"\n            @click=\"emits('send-msg')\"\n          >\n            <template #icon>\n              <n-icon> <Send /> </n-icon>\n            </template>\n          </n-button>\n        </template>\n      </n-input>\n    </div>\n    <!-- <div class=\"mb-1 mx-auto\">\n        <n-text depth=\"3\" class=\"text-size-[0.6rem]\">\n          {{ currentAvaliableAskCountsTip }}\n        </n-text>\n      </div> -->\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { LogoMarkdown, Print, Send, Stop } from '@vicons/ionicons5';\nimport { FullscreenRound, KeyboardDoubleArrowDownRound, KeyboardDoubleArrowUpRound } from '@vicons/material';\nimport { useThemeVars } from 'naive-ui';\nimport { computed, ref } from 'vue';\nimport { useI18n } from 'vue-i18n';\n\nimport { useAppStore } from '@/store';\n\nconst themeVars = useThemeVars();\nconst appStore = useAppStore();\nconst { t } = useI18n();\n\nconst props = defineProps<{\n  canAbort: boolean;\n  sendDisabled: boolean;\n  inputValue: string;\n  autoScrolling: boolean;\n}>();\n\nconst autoScrolling = computed({\n  get() {\n    return props.autoScrolling;\n  },\n  set(value) {\n    emits('update:auto-scrolling', value);\n  },\n});\n\nconst inputExpanded = ref<boolean>(false);\nconst inputStyle = computed(() => {\n  if (!inputExpanded.value)\n    return {\n      height: 'auto',\n      maxHeight: '16vh',\n    };\n  return {\n    height: '30vh',\n  };\n});\n\nconst inputValue = computed({\n  get() {\n    return props.inputValue;\n  },\n  set(value) {\n    emits('update:input-value', value);\n  },\n});\n\nconst emits = defineEmits<{\n  (e: 'abort-request'): void;\n  (e: 'send-msg'): void;\n  (e: 'export-to-markdown-file'): void;\n  (e: 'export-to-pdf-file'): void;\n  (e: 'show-fullscreen-history'): void;\n  (e: 'update:auto-scrolling', value: boolean): void;\n  (e: 'update:input-value', value: string): void;\n}>();\n\nconst toggleInputExpanded = () => {\n  inputExpanded.value = !inputExpanded.value;\n};\n\nconst shortcutSendMsg = (e: KeyboardEvent) => {\n  const sendKey = appStore.preference.sendKey; // \"Shift+Enter\" or \"Ctrl+Enter\" or \"Enter\"\n  if (sendKey === 'Enter' && e.key === 'Enter' && !e.shiftKey && !e.ctrlKey) {\n    e.preventDefault();\n    emits('send-msg');\n  } else if (sendKey === 'Shift+Enter' && e.key === 'Enter' && e.shiftKey && !e.ctrlKey) {\n    e.preventDefault();\n    emits('send-msg');\n  } else if (sendKey === 'Ctrl+Enter' && e.key === 'Enter' && !e.shiftKey && e.ctrlKey) {\n    e.preventDefault();\n    emits('send-msg');\n  }\n};\n</script>\n\n<style>\n.n-divider {\n  margin-bottom: 0px !important;\n  margin-top: 0px !important;\n}\n</style>\n","<template>\n  <n-card content-style=\"padding: 0;\">\n    <n-collapse @update:expanded-names=\"handleExpand\">\n      <n-collapse-item\n        :title=\"$t('commons.serverStatus')\"\n        name=\"serverStatus\"\n      >\n        <n-list\n          hoverable\n          show-divider\n        >\n          <!-- <n-list-item>\n            <div class=\"flex flex-row justify-between content-center\">\n              <div>\n                <n-icon class=\"mr-1\">\n                  <md-people />\n                </n-icon>{{ $t('commons.activeUserIn5m') }}\n              </div>\n              <div>{{ serverStatus.active_user_in_5m }}</div>\n            </div>\n          </n-list-item>\n          <n-list-item>\n            <div class=\"flex flex-row justify-between content-center\">\n              <div>\n                <n-icon class=\"mr-1\">\n                  <md-people />\n                </n-icon>{{ $t('commons.activeUserIn1h') }}\n              </div>\n              <div>{{ serverStatus.active_user_in_1h }}</div>\n            </div>\n          </n-list-item>\n          <n-list-item>\n            <div class=\"flex flex-row justify-between content-center\">\n              <div>\n                <n-icon class=\"mr-1\">\n                  <md-people />\n                </n-icon>{{ $t('commons.activeUserIn1d') }}\n              </div>\n              <div>{{ serverStatus.active_user_in_1d }}</div>\n            </div>\n          </n-list-item> -->\n          <n-list-item>\n            <div class=\"flex flex-row justify-between content-center\">\n              <div>\n                <n-icon class=\"mr-1\">\n                  <EventBusyFilled />\n                </n-icon>{{ $t('commons.isChatbotBusy') }}\n              </div>\n              <div>{{ serverStatus.is_chatbot_busy ? $t('commons.yes') : $t('commons.no') }}</div>\n            </div>\n          </n-list-item>\n          <n-list-item>\n            <div class=\"flex flex-row justify-between content-center\">\n              <div>\n                <n-icon class=\"mr-1\">\n                  <QueueFilled />\n                </n-icon>{{ $t('commons.chatbotWaitingCount') }}\n              </div>\n              <div>{{ serverStatus.chatbot_waiting_count }}</div>\n            </div>\n          </n-list-item>\n        </n-list>\n      </n-collapse-item>\n    </n-collapse>\n  </n-card>\n</template>\n\n<script setup lang=\"ts\">\nimport { MdPeople } from '@vicons/ionicons4';\nimport { EventBusyFilled, QueueFilled } from '@vicons/material';\nimport { ref } from 'vue';\nimport { useI18n } from 'vue-i18n';\n\nimport { getServerStatusApi } from '@/api/status';\nimport { ServerStatusSchema } from '@/types/schema';\nconst { t } = useI18n();\nconst serverStatus = ref<ServerStatusSchema>({});\n\nconst isExpaned = ref(false);\n\nconst handleExpand = (names: string[]) => {\n  if (names.length > 0) {\n    isExpaned.value = true;\n    updateData();\n  } else {\n    isExpaned.value = false;\n  }\n};\n\nconst updateData = () => {\n  if (isExpaned.value)\n    getServerStatusApi().then((res) => {\n      // console.log(res.data);\n      serverStatus.value = res.data;\n    });\n};\nupdateData();\nsetInterval(updateData, 5000);\n</script>\n\n<style>\ndiv.n-collapse-item {\n  padding: 1em;\n}\n</style>\n","<template>\n  <div>\n    <StatusCard />\n    <div class=\"flex-grow flex flex-col\">\n      <!-- <div class=\"flex box-content\" v-if=\"!newConversation\"> -->\n      <n-button\n        secondary\n        strong\n        type=\"primary\"\n        :disabled=\"props.loading\"\n        @click=\"emits('new-conversation')\"\n      >\n        <template #icon>\n          <n-icon class=\"\">\n            <Add />\n          </n-icon>\n        </template>\n        {{ $t('commons.newConversation') }}\n      </n-button>\n      <!-- </div> -->\n      <n-scrollbar class=\"h-0 flex-grow mt-4\">\n        <n-menu\n          ref=\"menuRef\"\n          v-model:value=\"convId\"\n          class=\"-mx-2\"\n          :content-style=\"{ backgroundColor: 'red' }\"\n          :disabled=\"props.loading\"\n          :options=\"menuOptions\"\n          :root-indent=\"18\"\n        />\n      </n-scrollbar>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport { Add } from '@vicons/ionicons5';\nimport { NEllipsis } from 'naive-ui';\nimport { computed, h } from 'vue';\nimport { useI18n } from 'vue-i18n';\n\nimport { useConversationStore } from '@/store';\nimport { ConversationSchema } from '@/types/schema';\nimport { dropdownRenderer, popupChangeConversationTitleDialog } from '@/utils/renders';\nimport { Dialog, Message } from '@/utils/tips';\n\nimport StatusCard from './StatusCard.vue';\n\nconst { t } = useI18n();\n\nconst conversationStore = useConversationStore();\n\nconst props = defineProps<{\n  loading: boolean;\n  value: string | null;\n  newConv: ConversationSchema | null;\n}>();\n\nconst emits = defineEmits<{\n  (e: 'update:value', value: string | null): void;\n  (e: 'new-conversation'): void;\n}>();\n\n// get and set to bind convId and value\nconst convId = computed<string | null>({\n  get() {\n    return props.value;\n  },\n  set(value: string | null) {\n    emits('update:value', value);\n  },\n});\n\nconst menuOptions = computed(() => {\n  // 根据 created_time 降序排序\n  const sorted_conversations = conversationStore.conversations\n    ?.slice() // 创建一个新的数组副本\n    .sort((a: ConversationSchema, b: ConversationSchema) => {\n      // return a.create_time - b.create_time;\n      if (!a.create_time) return -1;\n      if (!b.create_time) return 1;\n      const date_a = new Date(a.create_time),\n        date_b = new Date(b.create_time);\n      return date_b.getTime() - date_a.getTime();\n    });\n  const results = sorted_conversations?.map((conversation: ConversationSchema) => {\n    return {\n      label: () => h(NEllipsis, null, { default: () => conversation.title }),\n      key: conversation.conversation_id,\n      disabled: props.loading == true,\n      extra: () => dropdownRenderer(conversation, handleDeleteConversation, handleChangeConversationTitle),\n    };\n  });\n  if (props.newConv) {\n    results?.unshift({\n      label: props.newConv.title,\n      key: props.newConv.conversation_id,\n      disabled: props.loading == true,\n    });\n  }\n  return results;\n});\n\nconst handleDeleteConversation = (conversation_id: string | undefined) => {\n  if (!conversation_id) return;\n  const d = Dialog.info({\n    title: t('commons.confirmDialogTitle'),\n    content: t('tips.deleteConversation'),\n    positiveText: t('commons.confirm'),\n    negativeText: t('commons.cancel'),\n    onPositiveClick: () => {\n      d.loading = true;\n      return new Promise((resolve) => {\n        conversationStore\n          .deleteConversation(conversation_id)\n          .then(() => {\n            Message.success(t('tips.deleteConversationSuccess'));\n            if (convId.value == conversation_id) convId.value = null;\n          })\n          .catch(() => {\n            Message.error(t('tips.deleteConversationFailed'));\n          })\n          .finally(() => {\n            d.loading = false;\n            resolve(true);\n          });\n      });\n    },\n  });\n};\n\nconst handleChangeConversationTitle = (conversation_id: string | undefined) => {\n  if (!conversation_id) return;\n  popupChangeConversationTitleDialog(\n    conversation_id,\n    async (title: string) => {\n      await conversationStore.changeConversationTitle(conversation_id, title);\n    },\n    () => {\n      Message.success(t('tips.changeConversationTitleSuccess'));\n    },\n    () => {\n      Message.error(t('tips.changeConversationTitleFailed'));\n    }\n  );\n};\n</script>\n\n<style>\n@media print {\n  body * {\n    visibility: hidden;\n  }\n\n  #print-content * {\n    visibility: visible;\n  }\n\n  /* no margin in page */\n  @page {\n    margin-left: 0;\n    margin-right: 0;\n  }\n}\n</style>\n","(function(a,b){if(\"function\"==typeof define&&define.amd)define([],b);else if(\"undefined\"!=typeof exports)b();else{b(),a.FileSaver={exports:{}}.exports}})(this,function(){\"use strict\";function b(a,b){return\"undefined\"==typeof b?b={autoBom:!1}:\"object\"!=typeof b&&(console.warn(\"Deprecated: Expected third argument to be a object\"),b={autoBom:!b}),b.autoBom&&/^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(a.type)?new Blob([\"\\uFEFF\",a],{type:a.type}):a}function c(a,b,c){var d=new XMLHttpRequest;d.open(\"GET\",a),d.responseType=\"blob\",d.onload=function(){g(d.response,b,c)},d.onerror=function(){console.error(\"could not download file\")},d.send()}function d(a){var b=new XMLHttpRequest;b.open(\"HEAD\",a,!1);try{b.send()}catch(a){}return 200<=b.status&&299>=b.status}function e(a){try{a.dispatchEvent(new MouseEvent(\"click\"))}catch(c){var b=document.createEvent(\"MouseEvents\");b.initMouseEvent(\"click\",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(b)}}var f=\"object\"==typeof window&&window.window===window?window:\"object\"==typeof self&&self.self===self?self:\"object\"==typeof global&&global.global===global?global:void 0,a=f.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),g=f.saveAs||(\"object\"!=typeof window||window!==f?function(){}:\"download\"in HTMLAnchorElement.prototype&&!a?function(b,g,h){var i=f.URL||f.webkitURL,j=document.createElement(\"a\");g=g||b.name||\"download\",j.download=g,j.rel=\"noopener\",\"string\"==typeof b?(j.href=b,j.origin===location.origin?e(j):d(j.href)?c(b,g,h):e(j,j.target=\"_blank\")):(j.href=i.createObjectURL(b),setTimeout(function(){i.revokeObjectURL(j.href)},4E4),setTimeout(function(){e(j)},0))}:\"msSaveOrOpenBlob\"in navigator?function(f,g,h){if(g=g||f.name||\"download\",\"string\"!=typeof f)navigator.msSaveOrOpenBlob(b(f,h),g);else if(d(f))c(f,g,h);else{var i=document.createElement(\"a\");i.href=f,i.target=\"_blank\",setTimeout(function(){e(i)})}}:function(b,d,e,g){if(g=g||open(\"\",\"_blank\"),g&&(g.document.title=g.document.body.innerText=\"downloading...\"),\"string\"==typeof b)return c(b,d,e);var h=\"application/octet-stream\"===b.type,i=/constructor/i.test(f.HTMLElement)||f.safari,j=/CriOS\\/[\\d]+/.test(navigator.userAgent);if((j||h&&i||a)&&\"undefined\"!=typeof FileReader){var k=new FileReader;k.onloadend=function(){var a=k.result;a=j?a:a.replace(/^data:[^;]*;/,\"data:attachment/file;\"),g?g.location.href=a:location=a,g=null},k.readAsDataURL(b)}else{var l=f.URL||f.webkitURL,m=l.createObjectURL(b);g?g.location=m:location.href=m,g=null,setTimeout(function(){l.revokeObjectURL(m)},4E4)}});f.saveAs=g.saveAs=g,\"undefined\"!=typeof module&&(module.exports=g)});\n\n//# sourceMappingURL=FileSaver.min.js.map","import { saveAs } from 'file-saver';\n\nimport { ChatMessage } from '@/types/custom';\nimport { ConversationSchema } from '@/types/schema';\nimport { getModelNameTrans } from '@/utils/renders';\n\nexport const saveAsMarkdown = (conv: ConversationSchema, messageList: ChatMessage[]) => {\n  let content = `# ${conv.title}\\n\\n`;\n  const create_time = new Date(conv.create_time ? conv.create_time + 'Z' : new Date()).toLocaleString();\n  content += `Date: ${create_time}\\nModel: ${getModelNameTrans(conv.model_name as any)}\\n`;\n  // content += 'generated by [ChatGPT Web Share](https://github.com/moeakwak/chatgpt-web-share)\\n\\n';\n  content += '---\\n\\n';\n  let index = 0;\n  for (const message of messageList) {\n    if (message.author_role === 'user') {\n      // 选取第一行作为标题，最多50个字符，如果有省略则加上...\n      let title = message.message!.trim().split('\\n')[0];\n      if (title.length >= 50) {\n        title = title.slice(0, 47) + '...';\n      }\n      content += `## ${++index}. ${title}\\n\\n`;\n      content += `### User\\n\\n${message.message}\\n\\n`;\n    } else {\n      content += `### ChatGPT\\n\\n${message.message}\\n\\n`;\n      content += '---\\n\\n';\n    }\n  }\n  const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });\n  saveAs(blob, `${conv.title} - ChatGPT history.md`);\n};\n","<template>\n  <div\n    ref=\"rootRef\"\n    :class=\"['flex-grow flex flex-col md:flex-row', !appStore.preference.widerConversationPage ? 'lg:w-screen-lg lg:mx-auto' : '']\"\n  >\n    <!-- 左栏 -->\n    <LeftBar\n      v-show=\"!foldLeftBar\"\n      v-model:value=\"currentConversationId\"\n      :class=\"[\n        'md:min-w-50 pl-4 lt-md:pr-4 box-border mb-4 lt-md:h-56 md:flex-grow overflow-hidden flex flex-col space-y-4',\n        appStore.preference.widerConversationPage ? 'md:w-1/5' : 'md:w-1/4',\n      ]\"\n      :loading=\"loadingBar\"\n      :new-conv=\"newConversation\"\n      @new-conversation=\"makeNewConversation\"\n    />\n    <!-- 右栏 -->\n    <div\n      :class=\"[\n        'flex-grow flex flex-col md:px-4',\n        appStore.preference.widerConversationPage ? 'md:w-4/5' : 'md:w-3/4',\n      ]\"\n    >\n      <n-card\n        class=\"flex-grow md:mb-4 relative\"\n        :bordered=\"true\"\n        content-style=\"padding: 0; display: flex; flex-direction: column; \"\n      >\n        <!-- 展开/收起左栏 -->\n        <div class=\"left-3 top-3 absolute z-20\">\n          <n-button\n            strong\n            secondary\n            :type=\"foldLeftBar ? 'default' : 'primary'\"\n            size=\"small\"\n            @click=\"foldLeftBar = !foldLeftBar\"\n          >\n            <template #icon>\n              <n-icon :component=\"MenuRound\" />\n            </template>\n          </n-button>\n        </div>\n        \n        <!-- 消息记录内容（用于全屏展示） -->\n        <n-scrollbar\n          v-if=\"currentConversationId\"\n          ref=\"historyRef\"\n          class=\"basis-0 flex-grow shrink-grow relative\"\n          :style=\"{'overflow-y': 'scroll','-webkit-overflow-scrolling': 'touch'}\"\n          :content-style=\"loadingHistory ? { height: '100%' } : { }\"\n        >\n          <!-- 回到底部按钮 -->\n          <div class=\"right-2 bottom-5 absolute z-20\">\n            <n-button\n              secondary\n              circle\n              size=\"small\"\n              @click=\"scrollToBottomSmooth\"\n            >\n              <template #icon>\n                <n-icon :component=\"ArrowDown\" />\n              </template>\n            </n-button>\n          </div>\n          <HistoryContent\n            ref=\"historyContentRef\"\n            :messages=\"currentMessageListDisplay\"\n            :fullscreen=\"false\"\n            :model-name=\"currentConversation?.model_name || ''\"\n            :show-tips=\"showFullscreenTips\"\n            :loading=\"loadingHistory\"\n          />\n        </n-scrollbar>\n        <!-- 未选中对话（空界面） -->\n        <div\n          v-else-if=\"!currentConversationId\"\n          class=\"flex-grow flex flex-col justify-center\"\n          :style=\"{ backgroundColor: themeVars.cardColor }\"\n        >\n          <n-empty\n            v-if=\"!currentConversation\"\n            :description=\"$t('tips.loadConversation')\"\n          >\n            <template #icon>\n              <n-icon>\n                <ChatboxEllipses />\n              </n-icon>\n            </template>\n            <template #extra>\n              <n-button @click=\"makeNewConversation\">\n                {{ $t('tips.newConversation') }}\n              </n-button>\n            </template>\n          </n-empty>\n        </div>\n        <!-- 下半部分（回复区域） -->\n        <InputRegion\n          v-model:input-value=\"inputValue\"\n          v-model:auto-scrolling=\"autoScrolling\"\n          :can-abort=\"canAbort\"\n          :send-disabled=\"sendDisabled\"\n          @abort-request=\"abortRequest\"\n          @export-to-markdown-file=\"exportToMarkdownFile\"\n          @export-to-pdf-file=\"exportToPdfFile\"\n          @send-msg=\"sendMsg\"\n          @show-fullscreen-history=\"showFullscreenHistory\"\n        />\n      </n-card>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ArrowDown, ChatboxEllipses } from '@vicons/ionicons5';\nimport { MenuRound } from '@vicons/material';\nimport { RemovableRef, useStorage } from '@vueuse/core';\nimport { NButton, NIcon, useThemeVars } from 'naive-ui';\nimport { computed, ref, watch } from 'vue';\nimport { useI18n } from 'vue-i18n';\n\nimport { AskInfo, getAskWebsocketApiUrl } from '@/api/chat';\nimport { useAppStore, useConversationStore, useUserStore } from '@/store';\nimport { ChatConversationDetail, ChatMessage } from '@/types/custom';\nimport { ConversationSchema } from '@/types/schema';\nimport { getConvMessageListFromId } from '@/utils/conversation';\nimport { popupNewConversationDialog } from '@/utils/renders';\nimport { Dialog, LoadingBar, Message } from '@/utils/tips';\nimport HistoryContent from '@/views/conversation/components/HistoryContent.vue';\nimport InputRegion from '@/views/conversation/components/InputRegion.vue';\nimport LeftBar from '@/views/conversation/components/LeftBar.vue';\n\nimport { saveAsMarkdown } from './utils/export';\n\nconst themeVars = useThemeVars();\n\nconst { t } = useI18n();\n\nconst rootRef = ref();\nconst historyRef = ref();\nconst userStore = useUserStore();\nconst appStore = useAppStore();\nconst conversationStore = useConversationStore();\n\nconst loadingBar = ref(false);\nconst loadingHistory = ref<boolean>(false);\nconst autoScrolling = ref<boolean>(true);\n\nconst isAborted = ref<boolean>(false);\nconst canAbort = ref<boolean>(false);\nconst foldLeftBar = ref<RemovableRef<boolean>>(useStorage('foldLeftBar', false));\nlet aborter: (() => void) | null = null;\n\n// const currentAvaliableAskCountsTip = computed(() => {\n//   let result = '';\n//   if (userStore.user?.available_ask_count != -1)\n//     result += `${t('commons.availableAskCount')}: ${getCountTrans(userStore.user?.available_ask_count!)}   `;\n//   if (currentConversation.value && currentConversation.value.model_name === 'gpt-4' && userStore.user?.available_gpt4_ask_count != -1)\n//     result += `${t('commons.availableGPT4AskCount')}: ${getCountTrans(userStore.user?.available_gpt4_ask_count!)}`;\n//   return result;\n// });\n\nconst newConversation = ref<ConversationSchema | null>(null);\nconst currentConversationId = ref<string | null>(null);\nconst currentConversation = computed<ConversationSchema>(() => {\n  if (newConversation.value?.conversation_id === currentConversationId.value) return newConversation.value;\n  const conv = conversationStore.conversations?.find((conversation: ConversationSchema) => {\n    return conversation.conversation_id == currentConversationId.value;\n  });\n  return conv;\n});\n\nconst inputValue = ref('');\nconst currentActiveMessageSend = ref<ChatMessage | null>(null);\nconst currentActiveMessageRecv = ref<ChatMessage | null>(null);\nconst currentMessageListDisplay = computed(() => {\n  const conversationId = currentConversationId.value;\n  if (!conversationId) return [];\n  // const _ensure_conv = conversationStore.conversationDetailMap[props.conversationId];\n  let result = getConvMessageListFromId(conversationId);\n  if (currentActiveMessages.value.length > 0) {\n    result = result.concat(currentActiveMessages.value);\n  }\n  return result;\n});\n\n// 从 store 中获取当前对话最新消息的 id\nconst currentNode = computed<string | undefined>(() => {\n  if (currentConversation.value?.conversation_id)\n    return conversationStore.conversationDetailMap[currentConversation.value?.conversation_id]?.current_node;\n  else return undefined;\n});\n\n// 实际的 currentMessageList，加上当前正在发送的消息\nconst currentActiveMessages = computed<Array<ChatMessage>>(() => {\n  const result: ChatMessage[] = [];\n  if (currentActiveMessageSend.value && result.findIndex((message) => message.id === currentActiveMessageSend.value?.id) === -1)\n    result.push(currentActiveMessageSend.value);\n  if (currentActiveMessageRecv.value && result.findIndex((message) => message.id === currentActiveMessageRecv.value?.id) === -1)\n    result.push(currentActiveMessageRecv.value);\n  return result;\n});\n\nwatch(currentConversationId, (newVal, _oldVal) => {\n  if (newVal != 'new_conversation') {\n    handleChangeConversation(newVal);\n  }\n});\n\nconst handleChangeConversation = (key: string | null) => {\n  // TODO: 清除当前已询问、得到回复，但是发生错误的两条消息\n  if (loadingBar.value || !key) return;\n  loadingBar.value = true;\n  loadingHistory.value = true;\n  LoadingBar.start();\n  conversationStore\n    .fetchConversationHistory(key)\n    .then(() => {\n      // console.log(conversationStore.conversationDetailMap);\n    })\n    .catch((err: any) => {\n      console.log(err);\n    })\n    .finally(() => {\n      loadingBar.value = false;\n      loadingHistory.value = false;\n      LoadingBar.finish();\n    });\n};\n\nconst sendDisabled = computed(() => {\n  return loadingBar.value || currentConversationId.value == null || inputValue.value === null || inputValue.value.trim() == '';\n});\n\nconst makeNewConversation = () => {\n  if (newConversation.value) return;\n  popupNewConversationDialog(async (title: string, model_name: any) => {\n    // console.log(title, model_name);\n    newConversation.value = {\n      conversation_id: 'new_conversation',\n      // 默认标题格式：MMDD - username\n      title: title || `New Chat ${new Date().toLocaleString()} - ${userStore.user?.username}`,\n      model_name: model_name || 'text-davinci-002-render-sha',\n      create_time: new Date().toISOString(), // 仅用于当前排序到顶部\n    };\n    currentConversationId.value = 'new_conversation';\n  });\n};\n\nconst abortRequest = () => {\n  if (aborter == null || !canAbort.value) return;\n  aborter();\n  aborter = null;\n};\n\nconst scrollToBottom = () => {\n  historyRef.value.scrollTo({ left: 0, top: historyRef.value.$refs.scrollbarInstRef.contentRef.scrollHeight });\n};\n\nconst scrollToBottomSmooth = () => {\n  historyRef.value.scrollTo({ left: 0, top: historyRef.value.$refs.scrollbarInstRef.contentRef.scrollHeight, behavior: 'smooth' });\n};\n\nconst sendMsg = async () => {\n  if (sendDisabled.value || loadingBar.value) {\n    Message.error(t('tips.pleaseSelectConversation'));\n    return;\n  }\n\n  LoadingBar.start();\n  loadingBar.value = true;\n  const message = inputValue.value;\n  inputValue.value = '';\n\n  canAbort.value = false;\n  isAborted.value = false;\n  let hasGotReply = false;\n\n  const askInfo: AskInfo = { message };\n  if (newConversation.value) {\n    askInfo.new_title = newConversation.value.title;\n    askInfo.model_name = newConversation.value.model_name;\n  } else {\n    askInfo.conversation_id = currentConversation.value!.conversation_id;\n    askInfo.parent_id = currentNode.value!;\n  }\n\n  // 使用临时的随机 id 保持当前更新的两个消息\n  const random_strid = Math.random().toString(36).substring(2, 16);\n  currentActiveMessageSend.value = {\n    id: `send_${random_strid}`,\n    message,\n    author_role: 'user',\n    parent: currentNode.value,\n    children: [`recv_${random_strid}`],\n  };\n  currentActiveMessageRecv.value = {\n    id: `recv_${random_strid}`,\n    message: '',\n    author_role: 'assistent',\n    parent: `send_${random_strid}`,\n    children: [],\n    typing: true,\n    model_slug: currentConversation.value?.model_name,\n  };\n  const wsUrl = getAskWebsocketApiUrl();\n  let wsErrorMessage: string | null = null;\n  console.log('Connecting to', wsUrl, askInfo);\n  const webSocket = new WebSocket(wsUrl);\n\n  webSocket.onopen = (_event: Event) => {\n    // console.log('WebSocket connection is open', askInfo);\n    webSocket.send(JSON.stringify(askInfo));\n  };\n\n  webSocket.onmessage = (event: MessageEvent) => {\n    const reply = JSON.parse(event.data);\n    // console.log('Received message from server:', reply);\n    if (!reply.type) return;\n    if (reply.type === 'waiting') {\n      // 等待回复\n      canAbort.value = false;\n      currentActiveMessageRecv.value!.message = t(reply.tip);\n    } else if (reply.type === 'queueing') {\n      // 正在排队\n      canAbort.value = true;\n      currentActiveMessageRecv.value!.message = t(reply.tip);\n      // if (reply.waiting_count) {\n      //   currentActiveMessageRecv.value!.message += `(${reply.waiting_count})`;\n      // }\n    } else if (reply.type === 'message') {\n      // console.log(reply)\n      hasGotReply = true;\n      currentActiveMessageRecv.value!.message = reply.message;\n      currentActiveMessageRecv.value!.id = reply.parent_id;\n      currentActiveMessageRecv.value!.model_slug = reply.model_name;\n      if (newConversation.value) {\n        newConversation.value.model_name = reply.model_name;\n        if (newConversation.value.conversation_id !== reply.conversation_id) newConversation.value.conversation_id = reply.conversation_id;\n        if (currentConversationId.value !== newConversation.value.conversation_id) {\n          currentConversationId.value = newConversation.value.conversation_id!;\n        }\n      }\n      canAbort.value = true;\n    } else if (reply.type === 'error') {\n      currentActiveMessageRecv.value!.message = `${t(reply.tip)}: ${reply.message}}`;\n      console.error(reply.tip, reply.message);\n      if (reply.message) {\n        wsErrorMessage = reply.message;\n      }\n    }\n    if (autoScrolling.value) scrollToBottom();\n  };\n\n  webSocket.onclose = async (event: CloseEvent) => {\n    aborter = null;\n    canAbort.value = false;\n    currentActiveMessageRecv.value!.typing = false;\n    console.log('WebSocket connection is closed', event, isAborted.value);\n    if (isAborted.value || event.code === 1000) {\n      // 正常关闭\n      if (hasGotReply) {\n        if (newConversation.value) {\n          // 解析 ISO string 为 小数时间戳\n          const create_time = new Date(newConversation.value.create_time!).getTime() / 1000;\n          const newConvDetail = {\n            id: currentConversationId.value,\n            title: newConversation.value!.title,\n            model_name: newConversation.value!.model_name,\n            create_time,\n            mapping: {},\n            current_node: null,\n          } as ChatConversationDetail;\n          conversationStore.$patch({\n            conversationDetailMap: {\n              [newConversation.value.conversation_id!]: newConvDetail,\n            },\n          });\n          const msgSend = currentActiveMessageSend.value;\n          const msgRecv = currentActiveMessageRecv.value;\n          currentActiveMessageSend.value = null;\n          currentActiveMessageRecv.value = null;\n          conversationStore.addMessageToConversation(currentConversationId.value, msgSend, msgRecv);\n          currentConversationId.value = newConversation.value.conversation_id!; // 这里将会导致 currentConversation 切换\n          await conversationStore.fetchAllConversations();\n          newConversation.value = null;\n          console.log('done', newConvDetail, msgSend, msgRecv, currentConversationId.value);\n        } else {\n          // 将新消息存入 store\n          if (!currentActiveMessageRecv.value!.id.startsWith('recv')) {\n            // TODO 其它属性\n            conversationStore.addMessageToConversation(currentConversationId.value, currentActiveMessageSend.value!, currentActiveMessageRecv.value!);\n          }\n          currentActiveMessageSend.value = null;\n          currentActiveMessageRecv.value = null;\n        }\n      }\n    } else {\n      Dialog.error({\n        title: t('errors.askError'),\n        content: wsErrorMessage != null ? `[${event.code}] ${t(event.reason)}: ${wsErrorMessage}` : `[${event.code}] ${t(event.reason)}`,\n        positiveText: t('commons.withdrawMessage'),\n        negativeText: t('commons.cancel'),\n        onPositiveClick: () => {\n          currentActiveMessageSend.value = null;\n          currentActiveMessageRecv.value = null;\n        },\n      });\n    }\n    await userStore.fetchUserInfo();\n    LoadingBar.finish();\n    loadingBar.value = false;\n    isAborted.value = false;\n  };\n\n  webSocket.onerror = (event: Event) => {\n    console.error('WebSocket error:', event);\n  };\n\n  aborter = () => {\n    isAborted.value = true;\n    webSocket.close();\n  };\n};\n\nconst exportToMarkdownFile = () => {\n  if (!currentConversation.value) {\n    Message.error(t('tips.pleaseSelectConversation'));\n    return;\n  }\n  saveAsMarkdown(currentConversation.value, currentMessageListDisplay.value);\n};\n\nconst historyContentRef = ref();\nconst showFullscreenTips = ref(false);\n\nconst showFullscreenHistory = () => {\n  if (!currentConversation.value) {\n    Message.error(t('tips.pleaseSelectConversation'));\n    return;\n  }\n  // focus historyContentRef\n  historyContentRef.value.focus();\n  historyContentRef.value.toggleFullscreenHistory(true);\n};\n\nconst exportToPdfFile = () => {\n  if (!currentConversation.value) {\n    Message.error(t('tips.pleaseSelectConversation'));\n    return;\n  }\n  historyContentRef.value.toggleFullscreenHistory(false);\n  window.print();\n  historyContentRef.value.toggleFullscreenHistory(false);\n};\n\n// 加载对话列表\nconversationStore.fetchAllConversations().then();\n</script>\n\n<style>\ntextarea.n-input__textarea-el {\n  resize: none;\n}\n\ndiv.n-menu-item-content-header {\n  display: flex;\n  justify-content: space-between;\n}\n\nspan.n-menu-item-content-header__extra {\n  display: inline-block;\n}\n\n.left-col .n-card__content {\n  @apply flex flex-col overflow-auto !important;\n}\n\n@media print {\n  body * {\n    visibility: hidden;\n  }\n\n  #print-content * {\n    visibility: visible;\n  }\n\n  /* no margin in page */\n  @page {\n    margin-left: 0;\n    margin-right: 0;\n  }\n}\n</style>\n"],"names":["_hoisted_1","_hoisted_2","_createElementVNode","_hoisted_3","_hoisted_4","Add","defineComponent","_ctx","_cache","_openBlock","_createElementBlock","ArrowDown","ChatboxEllipses","LogoMarkdown","Print","Send","Stop","EventBusyFilled","FullscreenRound","KeyboardDoubleArrowDownRound","KeyboardDoubleArrowUpRound","MenuRound","QueueFilled","themeVars","useThemeVars","appStore","useAppStore","t","useI18n","autoScrolling","computed","props","value","emits","inputExpanded","ref","inputStyle","inputValue","toggleInputExpanded","shortcutSendMsg","sendKey","serverStatus","isExpaned","handleExpand","names","updateData","getServerStatusApi","res","conversationStore","useConversationStore","convId","menuOptions","sorted_conversations","_a","a","b","date_a","results","conversation","h","NEllipsis","dropdownRenderer","handleDeleteConversation","handleChangeConversationTitle","conversation_id","d","Dialog","resolve","Message","popupChangeConversationTitleDialog","title","this","c","g","e","f","global","i","j","k","l","m","module","saveAsMarkdown","conv","messageList","content","create_time","getModelNameTrans","index","message","blob","saveAs","rootRef","historyRef","userStore","useUserStore","loadingBar","loadingHistory","isAborted","canAbort","foldLeftBar","useStorage","aborter","newConversation","currentConversationId","currentConversation","_b","currentActiveMessageSend","currentActiveMessageRecv","currentMessageListDisplay","conversationId","result","getConvMessageListFromId","currentActiveMessages","currentNode","_c","watch","newVal","_oldVal","handleChangeConversation","key","LoadingBar","err","sendDisabled","makeNewConversation","popupNewConversationDialog","model_name","abortRequest","scrollToBottom","scrollToBottomSmooth","sendMsg","hasGotReply","askInfo","random_strid","wsUrl","getAskWebsocketApiUrl","wsErrorMessage","webSocket","_event","event","reply","newConvDetail","msgSend","msgRecv","exportToMarkdownFile","historyContentRef","showFullscreenTips","showFullscreenHistory","exportToPdfFile"],"mappings":"0mBACA,MAAMA,GAAa,CACjB,MAAO,6BACP,cAAe,+BACf,QAAS,aACX,EACMC,GAA2BC,EAC/B,OACA,CACE,KAAM,OACN,OAAQ,eACR,iBAAkB,QAClB,kBAAmB,QACnB,eAAgB,KAChB,EAAG,cACJ,EACD,KACA,EAEF,EACMC,GAA2BD,EAC/B,OACA,CACE,KAAM,OACN,OAAQ,eACR,iBAAkB,QAClB,kBAAmB,QACnB,eAAgB,KAChB,EAAG,cACJ,EACD,KACA,EAEF,EACME,GAAa,CAACH,GAAYE,EAAU,EAC1CE,GAAeC,EAAgB,CAC7B,KAAM,MACN,OAAQ,SAAgBC,EAAMC,EAAQ,CACpC,OAAOC,EAAU,EAAIC,EAAoB,MAAOV,GAAYI,EAAU,CACvE,CACH,CAAC,ECvCKJ,GAAa,CACjB,MAAO,6BACP,cAAe,+BACf,QAAS,aACX,EACMC,GAA2BC,EAC/B,OACA,CACE,KAAM,OACN,OAAQ,eACR,iBAAkB,QAClB,kBAAmB,QACnB,eAAgB,KAChB,EAAG,0BACJ,EACD,KACA,EAEF,EACMC,GAA2BD,EAC/B,OACA,CACE,KAAM,OACN,OAAQ,eACR,iBAAkB,QAClB,kBAAmB,QACnB,eAAgB,KAChB,EAAG,cACJ,EACD,KACA,EAEF,EACME,GAAa,CAACH,GAAYE,EAAU,EAC1CQ,GAAeL,EAAgB,CAC7B,KAAM,YACN,OAAQ,SAAgBC,EAAMC,EAAQ,CACpC,OAAOC,EAAU,EAAIC,EAAoB,MAAOV,GAAYI,EAAU,CACvE,CACH,CAAC,ECvCKJ,GAAa,CACjB,MAAO,6BACP,cAAe,+BACf,QAAS,aACX,EACMC,GAA2BC,EAC/B,OACA,CACE,EAAG,qSACH,KAAM,cACP,EACD,KACA,EAEF,EACMC,GAAa,CAACF,EAAU,EAC9BW,GAAeN,EAAgB,CAC7B,KAAM,kBACN,OAAQ,SAAgBC,EAAMC,EAAQ,CACpC,OAAOC,EAAU,EAAIC,EAAoB,MAAOV,GAAYG,EAAU,CACvE,CACH,CAAC,ECrBKH,GAAa,CACjB,MAAO,6BACP,cAAe,+BACf,QAAS,aACX,EACMC,GAA2BC,EAC/B,OACA,CACE,EAAG,2OACH,KAAM,cACP,EACD,KACA,EAEF,EACMC,GAAa,CAACF,EAAU,EAC9BY,GAAeP,EAAgB,CAC7B,KAAM,eACN,OAAQ,SAAgBC,EAAMC,EAAQ,CACpC,OAAOC,EAAU,EAAIC,EAAoB,MAAOV,GAAYG,EAAU,CACvE,CACH,CAAC,ECrBKH,GAAa,CACjB,MAAO,6BACP,cAAe,+BACf,QAAS,aACX,EACMC,GAA2BC,EAC/B,OACA,CACE,EAAG,uWACH,KAAM,cACP,EACD,KACA,EAEF,EACMC,GAA2BD,EAC/B,OACA,CACE,EAAG,0EACH,KAAM,cACP,EACD,KACA,EAEF,EACME,GAAa,CAACH,GAAYE,EAAU,EAC1CW,GAAeR,EAAgB,CAC7B,KAAM,QACN,OAAQ,SAAgBC,EAAMC,EAAQ,CACpC,OAAOC,EAAU,EAAIC,EAAoB,MAAOV,GAAYI,EAAU,CACvE,CACH,CAAC,EC/BKJ,GAAa,CACjB,MAAO,6BACP,cAAe,+BACf,QAAS,aACX,EACMC,GAA2BC,EAC/B,OACA,CACE,EAAG,2TACH,KAAM,cACP,EACD,KACA,EAEF,EACMC,GAAa,CAACF,EAAU,EAC9Bc,GAAeT,EAAgB,CAC7B,KAAM,OACN,OAAQ,SAAgBC,EAAMC,EAAQ,CACpC,OAAOC,EAAU,EAAIC,EAAoB,MAAOV,GAAYG,EAAU,CACvE,CACH,CAAC,ECrBKH,GAAa,CACjB,MAAO,6BACP,cAAe,+BACf,QAAS,aACX,EACMC,GAA2BC,EAC/B,OACA,CACE,EAAG,oGACH,KAAM,cACP,EACD,KACA,EAEF,EACMC,GAAa,CAACF,EAAU,EAC9Be,GAAeV,EAAgB,CAC7B,KAAM,OACN,OAAQ,SAAgBC,EAAMC,EAAQ,CACpC,OAAOC,EAAU,EAAIC,EAAoB,MAAOV,GAAYG,EAAU,CACvE,CACH,CAAC,ECrBKH,GAAa,CACjB,MAAO,6BACP,cAAe,+BACf,QAAS,WACX,EACMC,GAA2BC,EAC/B,OACA,CACE,EAAG,wPACH,KAAM,cACP,EACD,KACA,EAEF,EACMC,GAAa,CAACF,EAAU,EAC9BgB,GAAeX,EAAgB,CAC7B,KAAM,kBACN,OAAQ,SAAgBC,EAAMC,EAAQ,CACpC,OAAOC,EAAU,EAAIC,EAAoB,MAAOV,GAAYG,EAAU,CACvE,CACH,CAAC,ECrBKH,GAAa,CACjB,MAAO,6BACP,cAAe,+BACf,QAAS,WACX,EACMC,GAA2BC,EAC/B,OACA,CACE,EAAG,mWACH,KAAM,cACP,EACD,KACA,EAEF,EACMC,GAAa,CAACF,EAAU,EAC9BiB,GAAeZ,EAAgB,CAC7B,KAAM,kBACN,OAAQ,SAAgBC,EAAMC,EAAQ,CACpC,OAAOC,EAAU,EAAIC,EAAoB,MAAOV,GAAYG,EAAU,CACvE,CACH,CAAC,ECrBKH,GAAa,CACjB,MAAO,6BACP,cAAe,+BACf,QAAS,WACX,EACMC,GAA2BC,EAC/B,OACA,CACE,EAAG,6IACH,KAAM,cACP,EACD,KACA,EAEF,EACMC,GAA2BD,EAC/B,OACA,CACE,EAAG,mJACH,KAAM,cACP,EACD,KACA,EAEF,EACME,GAAa,CAACH,GAAYE,EAAU,EAC1CgB,GAAeb,EAAgB,CAC7B,KAAM,+BACN,OAAQ,SAAgBC,EAAMC,EAAQ,CACpC,OAAOC,EAAU,EAAIC,EAAoB,MAAOV,GAAYI,EAAU,CACvE,CACH,CAAC,EC/BKJ,GAAa,CACjB,MAAO,6BACP,cAAe,+BACf,QAAS,WACX,EACMC,GAA2BC,EAC/B,OACA,CACE,EAAG,gJACH,KAAM,cACP,EACD,KACA,EAEF,EACMC,GAA2BD,EAC/B,OACA,CACE,EAAG,8IACH,KAAM,cACP,EACD,KACA,EAEF,EACME,GAAa,CAACH,GAAYE,EAAU,EAC1CiB,GAAed,EAAgB,CAC7B,KAAM,6BACN,OAAQ,SAAgBC,EAAMC,EAAQ,CACpC,OAAOC,EAAU,EAAIC,EAAoB,MAAOV,GAAYI,EAAU,CACvE,CACH,CAAC,EC/BKJ,GAAa,CACjB,MAAO,6BACP,cAAe,+BACf,QAAS,WACX,EACMC,GAA2BC,EAC/B,OACA,CACE,EAAG,yMACH,KAAM,cACP,EACD,KACA,EAEF,EACMC,GAAa,CAACF,EAAU,EAC9BoB,GAAef,EAAgB,CAC7B,KAAM,YACN,OAAQ,SAAgBC,EAAMC,EAAQ,CACpC,OAAOC,EAAU,EAAIC,EAAoB,MAAOV,GAAYG,EAAU,CACvE,CACH,CAAC,ECrBKH,GAAa,CACjB,MAAO,6BACP,cAAe,+BACf,QAAS,WACX,EACMC,GAA2BC,EAC/B,OACA,CACE,EAAG,kJACH,KAAM,cACP,EACD,KACA,EAEF,EACMC,GAAa,CAACF,EAAU,EAC9BqB,GAAehB,EAAgB,CAC7B,KAAM,cACN,OAAQ,SAAgBC,EAAMC,EAAQ,CACpC,OAAOC,EAAU,EAAIC,EAAoB,MAAOV,GAAYG,EAAU,CACvE,CACH,CAAC,0eCiHDoB,EAAAC,KACAC,EAAAC,KACA,CAAA,EAAAC,GAAAC,IASAC,EAAAC,EAAA,CAA+B,KAAA,CAE3B,OAAAC,EAAA,aAAa,EACf,IAAAC,EAAA,CAEEC,EAAA,wBAAAD,CAAA,CAAoC,CACtC,CAAA,EAGFE,EAAAC,EAAA,EAAA,EACAC,EAAAN,EAAA,IACEI,EAAA,MAKA,CAAO,OAAA,MACG,EALR,CAAO,OAAA,OACG,UAAA,MACG,CAIf,EAGFG,EAAAP,EAAA,CAA4B,KAAA,CAExB,OAAAC,EAAA,UAAa,EACf,IAAAC,EAAA,CAEEC,EAAA,qBAAAD,CAAA,CAAiC,CACnC,CAAA,EAaFM,EAAA,IAAA,CACEJ,EAAA,MAAA,CAAAA,EAAA,KAAqC,EAGvCK,EAAA,GAAA,CACE,MAAAC,EAAAf,EAAA,WAAA,SACAe,IAAA,SAAA,EAAA,MAAA,SAAA,CAAA,EAAA,UAAA,CAAA,EAAA,SAEkBA,IAAA,eAAA,EAAA,MAAA,SAAA,EAAA,UAAA,CAAA,EAAA,SAGAA,IAAA,cAAA,EAAA,MAAA,SAAA,CAAA,EAAA,UAAA,EAAA,WAEhB,EAAA,eAAA,EACAP,EAAA,UAAA,EACF,u7DC9HFL,EAAA,EACA,MAAAa,EAAAN,EAAA,CAAA,CAAA,EAEAO,EAAAP,EAAA,EAAA,EAEAQ,EAAAC,GAAA,CACEA,EAAA,OAAA,GACEF,EAAA,MAAA,GACAG,KAEAH,EAAA,MAAA,EACF,EAGFG,EAAA,IAAA,CACEH,EAAA,OACEI,GAAA,EAAA,KAAAC,GAAA,CAEEN,EAAA,MAAAM,EAAA,IAAyB,CAAA,CAC1B,EAEL,OAAAF,IACA,YAAAA,EAAA,GAAA,y8BCjDA,CAAA,EAAAlB,GAAAC,IAEAoB,EAAAC,KAcAC,EAAApB,EAAA,CAAuC,KAAA,CAEnC,OAAAC,EAAA,KAAa,EACf,IAAAC,EAAA,CAEEC,EAAA,eAAAD,CAAA,CAA2B,CAC7B,CAAA,EAGFmB,EAAArB,EAAA,IAAA,OAEE,MAAAsB,GAAAC,EAAAL,EAAA,gBAAA,YAAAK,EAAA,QAAA,KAAA,CAAAC,EAAAC,IAAA,CAII,GAAA,CAAAD,EAAA,YAAoB,MAAA,GACpB,GAAA,CAAAC,EAAA,YAAoB,MAAA,GACpB,MAAAC,EAAA,IAAA,KAAAF,EAAA,WAAA,EAEA,OAFA,IAAA,KAAAC,EAAA,WAAA,EAEA,QAAA,EAAAC,EAAA,QAAA,CAAyC,GAE7CC,EAAAL,GAAA,YAAAA,EAAA,IAAAM,IACE,CAAO,MAAA,IAAAC,GAAAC,GAAA,KAAA,CAAA,QAAA,IAAAF,EAAA,MAAA,EACgE,IAAAA,EAAA,gBACnD,SAAA3B,EAAA,SAAA,GACS,MAAA,IAAA8B,GAAAH,EAAAI,EAAAC,CAAA,CACwE,IAGvG,OAAAhC,EAAA,UACE0B,GAAA,MAAAA,EAAA,QAAA,CAAiB,MAAA1B,EAAA,QAAA,MACM,IAAAA,EAAA,QAAA,gBACF,SAAAA,EAAA,SAAA,EACQ,IAG/B0B,CAAO,CAAA,EAGTK,EAAAE,GAAA,CACE,GAAA,CAAAA,EAAsB,OACtB,MAAAC,EAAAC,GAAA,KAAA,CAAsB,MAAAvC,EAAA,4BAAA,EACiB,QAAAA,EAAA,yBAAA,EACD,aAAAA,EAAA,iBAAA,EACH,aAAAA,EAAA,gBAAA,EACD,gBAAA,KAE9BsC,EAAA,QAAA,GACA,IAAA,QAAAE,GAAA,CACEnB,EAAA,mBAAAgB,CAAA,EAAA,KAAA,IAAA,CAGII,EAAA,QAAAzC,EAAA,gCAAA,CAAA,EACAuB,EAAA,OAAAc,IAAqCd,EAAA,MAAA,KAAe,CAAA,EAAA,MAAA,IAAA,CAGpDkB,EAAA,MAAAzC,EAAA,+BAAA,CAAA,CAAgD,CAAA,EAAA,QAAA,IAAA,CAGhDsC,EAAA,QAAA,GACAE,EAAA,EAAA,CAAY,CAAA,CACb,CAAA,EAEP,CAAA,CACD,EAGHJ,EAAAC,GAAA,CACEA,GACAK,GAAAL,EACE,MAAAM,GAAA,CAEE,MAAAtB,EAAA,wBAAAgB,EAAAM,CAAA,CAAsE,EACxE,IAAA,CAEEF,EAAA,QAAAzC,EAAA,qCAAA,CAAA,CAAwD,EAC1D,IAAA,CAEEyC,EAAA,MAAAzC,EAAA,oCAAA,CAAA,CAAqD,CACvD,CACF,8rBChJD,SAAS2B,EAAEC,EAAE,CAA2FA,EAAC,CAA6C,GAAGgB,EAAK,UAAU,CAAc,SAAShB,EAAED,EAAEC,EAAE,CAAC,OAAmB,OAAOA,EAApB,IAAsBA,EAAE,CAAC,QAAQ,EAAE,EAAY,OAAOA,GAAjB,WAAqB,QAAQ,KAAK,oDAAoD,EAAEA,EAAE,CAAC,QAAQ,CAACA,CAAC,GAAGA,EAAE,SAAS,6EAA6E,KAAKD,EAAE,IAAI,EAAE,IAAI,KAAK,CAAC,SAASA,CAAC,EAAE,CAAC,KAAKA,EAAE,IAAI,CAAC,EAAEA,CAAC,CAAC,SAASkB,EAAElB,EAAEC,EAAEiB,EAAE,CAAC,IAAIP,EAAE,IAAI,eAAeA,EAAE,KAAK,MAAMX,CAAC,EAAEW,EAAE,aAAa,OAAOA,EAAE,OAAO,UAAU,CAACQ,EAAER,EAAE,SAASV,EAAEiB,CAAC,CAAC,EAAEP,EAAE,QAAQ,UAAU,CAAC,QAAQ,MAAM,yBAAyB,CAAC,EAAEA,EAAE,KAAI,CAAE,CAAC,SAASA,EAAEX,EAAE,CAAC,IAAIC,EAAE,IAAI,eAAeA,EAAE,KAAK,OAAOD,EAAE,EAAE,EAAE,GAAG,CAACC,EAAE,MAAM,MAAC,CAAU,CAAA,MAAO,MAAKA,EAAE,QAAQ,KAAKA,EAAE,MAAM,CAAC,SAASmB,EAAEpB,EAAE,CAAC,GAAG,CAACA,EAAE,cAAc,IAAI,WAAW,OAAO,CAAC,CAAC,MAAC,CAAS,IAAIC,EAAE,SAAS,YAAY,aAAa,EAAEA,EAAE,eAAe,QAAQ,GAAG,GAAG,OAAO,EAAE,EAAE,EAAE,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,EAAE,IAAI,EAAED,EAAE,cAAcC,CAAC,CAAC,CAAC,CAAC,IAAIoB,EAAY,OAAO,QAAjB,UAAyB,OAAO,SAAS,OAAO,OAAiB,OAAO,MAAjB,UAAuB,KAAK,OAAO,KAAK,KAAe,OAAOC,GAAjB,UAAyBA,EAAO,SAASA,EAAOA,EAAO,OAAOtB,EAAEqB,EAAE,WAAW,YAAY,KAAK,UAAU,SAAS,GAAG,cAAc,KAAK,UAAU,SAAS,GAAG,CAAC,SAAS,KAAK,UAAU,SAAS,EAAEF,EAAEE,EAAE,SAAmB,OAAO,QAAjB,UAAyB,SAASA,EAAE,UAAU,CAAE,EAAC,aAAa,kBAAkB,WAAW,CAACrB,EAAE,SAASC,EAAEkB,EAAEd,EAAE,CAAC,IAAIkB,EAAEF,EAAE,KAAKA,EAAE,UAAUG,EAAE,SAAS,cAAc,GAAG,EAAEL,EAAEA,GAAGlB,EAAE,MAAM,WAAWuB,EAAE,SAASL,EAAEK,EAAE,IAAI,WAAqB,OAAOvB,GAAjB,UAAoBuB,EAAE,KAAKvB,EAAEuB,EAAE,SAAS,SAAS,OAAOJ,EAAEI,CAAC,EAAEb,EAAEa,EAAE,IAAI,EAAEN,EAAEjB,EAAEkB,EAAEd,CAAC,EAAEe,EAAEI,EAAEA,EAAE,OAAO,QAAQ,IAAIA,EAAE,KAAKD,EAAE,gBAAgBtB,CAAC,EAAE,WAAW,UAAU,CAACsB,EAAE,gBAAgBC,EAAE,IAAI,CAAC,EAAE,GAAG,EAAE,WAAW,UAAU,CAACJ,EAAEI,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE,qBAAqB,UAAU,SAASH,EAAEF,EAAEd,EAAE,CAAC,GAAGc,EAAEA,GAAGE,EAAE,MAAM,WAAqB,OAAOA,GAAjB,SAAmB,UAAU,iBAAiBpB,EAAEoB,EAAEhB,CAAC,EAAEc,CAAC,UAAUR,EAAEU,CAAC,EAAEH,EAAEG,EAAEF,EAAEd,CAAC,MAAM,CAAC,IAAIkB,EAAE,SAAS,cAAc,GAAG,EAAEA,EAAE,KAAKF,EAAEE,EAAE,OAAO,SAAS,WAAW,UAAU,CAACH,EAAEG,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,SAAStB,EAAEU,EAAES,EAAED,EAAE,CAAC,GAAGA,EAAEA,GAAG,KAAK,GAAG,QAAQ,EAAEA,IAAIA,EAAE,SAAS,MAAMA,EAAE,SAAS,KAAK,UAAU,kBAA4B,OAAOlB,GAAjB,SAAmB,OAAOiB,EAAEjB,EAAEU,EAAES,CAAC,EAAE,IAAIf,EAA+BJ,EAAE,OAA/B,2BAAoCsB,EAAE,eAAe,KAAKF,EAAE,WAAW,GAAGA,EAAE,OAAOG,EAAE,eAAe,KAAK,UAAU,SAAS,EAAE,IAAIA,GAAGnB,GAAGkB,GAAGvB,IAAiB,OAAO,WAApB,IAA+B,CAAC,IAAIyB,EAAE,IAAI,WAAWA,EAAE,UAAU,UAAU,CAAC,IAAIzB,EAAEyB,EAAE,OAAOzB,EAAEwB,EAAExB,EAAEA,EAAE,QAAQ,eAAe,uBAAuB,EAAEmB,EAAEA,EAAE,SAAS,KAAKnB,EAAE,SAASA,EAAEmB,EAAE,IAAI,EAAEM,EAAE,cAAcxB,CAAC,CAAC,KAAK,CAAC,IAAIyB,EAAEL,EAAE,KAAKA,EAAE,UAAUM,EAAED,EAAE,gBAAgBzB,CAAC,EAAEkB,EAAEA,EAAE,SAASQ,EAAE,SAAS,KAAKA,EAAER,EAAE,KAAK,WAAW,UAAU,CAACO,EAAE,gBAAgBC,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,GAAGN,EAAE,OAAOF,EAAE,OAAOA,EAA+BS,EAAA,QAAeT,CAAE,CAAC,QCMnoF,MAAAU,GAAiB,CAACC,EAA0BC,IAA+B,CAClF,IAAAC,EAAU,KAAKF,EAAK;AAAA;AAAA,EACxB,MAAMG,EAAc,IAAI,KAAKH,EAAK,YAAcA,EAAK,YAAc,IAAM,IAAI,IAAM,EAAE,eAAe,EACpGE,GAAW,SAASC;AAAA,SAAuBC,GAAkBJ,EAAK,UAAiB;AAAA,EAExEE,GAAA;AAAA;AAAA,EACX,IAAIG,EAAQ,EACZ,UAAWC,KAAWL,EAChB,GAAAK,EAAQ,cAAgB,OAAQ,CAE9B,IAAApB,EAAQoB,EAAQ,QAAS,OAAO,MAAM;AAAA,CAAI,EAAE,CAAC,EAC7CpB,EAAM,QAAU,KAClBA,EAAQA,EAAM,MAAM,EAAG,EAAE,EAAI,OAEpBgB,GAAA,MAAM,EAAEG,MAAUnB;AAAA;AAAA,EAClBgB,GAAA;AAAA;AAAA,EAAeI,EAAQ;AAAA;AAAA,CAAA,MAEvBJ,GAAA;AAAA;AAAA,EAAkBI,EAAQ;AAAA;AAAA,EAC1BJ,GAAA;AAAA;AAAA,EAGT,MAAAK,EAAO,IAAI,KAAK,CAACL,CAAO,EAAG,CAAE,KAAM,0BAAA,CAA4B,EAC9DM,EAAA,OAAAD,EAAM,GAAGP,EAAK,4BAA4B,CACnD,oHCyGA,MAAA7D,EAAAC,KAEA,CAAA,EAAAG,GAAAC,IAEAiE,EAAA1D,IACA2D,EAAA3D,IACA4D,EAAAC,KACAvE,EAAAC,KACAsB,EAAAC,KAEAgD,EAAA9D,EAAA,EAAA,EACA+D,EAAA/D,EAAA,EAAA,EACAN,EAAAM,EAAA,EAAA,EAEAgE,EAAAhE,EAAA,EAAA,EACAiE,EAAAjE,EAAA,EAAA,EACAkE,EAAAlE,EAAAmE,GAAA,cAAA,EAAA,CAAA,EACA,IAAAC,EAAA,KAWA,MAAAC,EAAArE,EAAA,IAAA,EACAsE,EAAAtE,EAAA,IAAA,EACAuE,EAAA5E,EAAA,IAAA,SACE,QAAAuB,EAAAmD,EAAA,QAAA,YAAAnD,EAAA,mBAAAoD,EAAA,MAA4ED,EAAA,OAC5EG,EAAA3D,EAAA,gBAAA,YAAA2D,EAAA,KAAAjD,GACEA,EAAA,iBAAA+C,EAAA,MAEK,CAAA,EAGTpE,EAAAF,EAAA,EAAA,EACAyE,EAAAzE,EAAA,IAAA,EACA0E,EAAA1E,EAAA,IAAA,EACA2E,EAAAhF,EAAA,IAAA,CACE,MAAAiF,EAAAN,EAAA,MACA,GAAA,CAAAM,EAAqB,MAAA,GAErB,IAAAC,EAAAC,GAAAF,CAAA,EACA,OAAAG,GAAA,MAAA,OAAA,IACEF,EAAAA,EAAA,OAAAE,GAAA,KAAA,GAEFF,CAAO,CAAA,EAITG,GAAArF,EAAA,IAAA,WACE,IAAAuB,EAAAqD,EAAA,QAAA,MAAArD,EAAA,gBACE,OAAA+D,EAAApE,EAAA,uBAAA2D,EAAAD,EAAA,QAAA,YAAAC,EAAA,eAAA,IAAA,YAAAS,EAAA,YACU,CAAA,EAIdF,GAAApF,EAAA,IAAA,CACE,MAAAkF,EAAA,CAAA,EACA,OAAAJ,EAAA,OAAAI,EAAA,UAAAtB,GAAA,OAAA,OAAAA,EAAA,OAAArC,EAAAuD,EAAA,QAAA,YAAAvD,EAAA,IAAA,IAAA,IACE2D,EAAA,KAAAJ,EAAA,KAAA,EACFC,EAAA,OAAAG,EAAA,UAAAtB,GAAA,OAAA,OAAAA,EAAA,OAAArC,EAAAwD,EAAA,QAAA,YAAAxD,EAAA,IAAA,IAAA,IACE2D,EAAA,KAAAH,EAAA,KAAA,EACFG,CAAO,CAAA,EAGTK,GAAAZ,EAAA,CAAAa,EAAAC,IAAA,CACED,GAAA,oBACEE,GAAAF,CAAA,CACF,CAAA,EAGF,MAAAE,GAAAC,GAAA,CAEExB,EAAA,OAAA,CAAAwB,IACAxB,EAAA,MAAA,GACAC,EAAA,MAAA,GACAwB,EAAA,MAAA,EACA1E,EAAA,yBAAAyE,CAAA,EAAA,KAAA,IAAA,CAEc,CAAA,EAAA,MAAAE,GAAA,CAIV,QAAA,IAAAA,CAAA,CAAe,CAAA,EAAA,QAAA,IAAA,CAGf1B,EAAA,MAAA,GACAC,EAAA,MAAA,GACAwB,EAAA,OAAA,CAAkB,CAAA,EACnB,EAGLE,GAAA9F,EAAA,IACEmE,EAAA,OAAAQ,EAAA,OAAA,MAAApE,EAAA,QAAA,MAAAA,EAAA,MAAA,KAAA,GAAA,EAA0H,EAG5HwF,GAAA,IAAA,CACErB,EAAA,OACAsB,GAAA,MAAAxD,EAAAyD,IAAA,OAEEvB,EAAA,MAAA,CAAwB,gBAAA,mBACL,MAAAlC,GAAA,YAAA,IAAA,KAAA,EAAA,eAAA,QAAAjB,EAAA0C,EAAA,OAAA,YAAA1C,EAAA,WAE4D,WAAA0E,GAAA,8BACnD,YAAA,IAAA,KAAA,EAAA,YAAA,CACU,EAEtCtB,EAAA,MAAA,kBAA8B,CAAA,CAC/B,EAGHuB,GAAA,IAAA,CACEzB,GAAA,MAAA,CAAAH,EAAA,QACAG,IACAA,EAAA,KAAU,EAGZ0B,GAAA,IAAA,CACEnC,EAAA,MAAA,SAAA,CAAA,KAAA,EAAA,IAAAA,EAAA,MAAA,MAAA,iBAAA,WAAA,YAAA,CAAA,CAA2G,EAG7GoC,GAAA,IAAA,CACEpC,EAAA,MAAA,SAAA,CAAA,KAAA,EAAA,IAAAA,EAAA,MAAA,MAAA,iBAAA,WAAA,aAAA,SAAA,QAAA,CAAA,CAA+H,EAGjIqC,GAAA,SAAA,QACE,GAAAP,GAAA,OAAA3B,EAAA,MAAA,CACE7B,EAAA,MAAAzC,EAAA,+BAAA,CAAA,EACA,MAAA,CAGF+F,EAAA,MAAA,EACAzB,EAAA,MAAA,GACA,MAAAP,EAAArD,EAAA,MACAA,EAAA,MAAA,GAEA+D,EAAA,MAAA,GACAD,EAAA,MAAA,GACA,IAAAiC,EAAA,GAEA,MAAAC,EAAA,CAAA3C,QAAAA,GACAc,EAAA,OACE6B,EAAA,UAAA7B,EAAA,MAAA,MACA6B,EAAA,WAAA7B,EAAA,MAAA,aAEA6B,EAAA,gBAAA3B,EAAA,MAAA,gBACA2B,EAAA,UAAAlB,GAAA,OAIF,MAAAmB,EAAA,KAAA,SAAA,SAAA,EAAA,EAAA,UAAA,EAAA,EAAA,EACA1B,EAAA,MAAA,CAAiC,GAAA,QAAA0B,IACnB,QAAA5C,EACZ,YAAA,OACa,OAAAyB,GAAA,MACO,SAAA,CAAA,QAAAmB,GAAA,CACa,EAEnCzB,EAAA,MAAA,CAAiC,GAAA,QAAAyB,IACnB,QAAA,GACH,YAAA,YACI,OAAA,QAAAA,IACG,SAAA,CAAA,EACL,OAAA,GACH,YAAAjF,GAAAqD,EAAA,QAAA,YAAArD,GAAA,UAC+B,EAEzC,MAAAkF,EAAAC,KACA,IAAAC,EAAA,KACA,QAAA,IAAA,gBAAAF,EAAAF,CAAA,EACA,MAAAK,EAAA,IAAA,UAAAH,CAAA,EAEAG,EAAA,OAAAC,GAAA,CAEED,EAAA,KAAA,KAAA,UAAAL,CAAA,CAAA,CAAsC,EAGxCK,EAAA,UAAAE,GAAA,CACE,MAAAC,EAAA,KAAA,MAAAD,EAAA,IAAA,EAEAC,EAAA,OACAA,EAAA,OAAA,WAEEzC,EAAA,MAAA,GACAS,EAAA,MAAA,QAAAlF,EAAAkH,EAAA,GAAA,GAAqDA,EAAA,OAAA,YAGrDzC,EAAA,MAAA,GACAS,EAAA,MAAA,QAAAlF,EAAAkH,EAAA,GAAA,GAAqDA,EAAA,OAAA,WAMrDT,EAAA,GACAvB,EAAA,MAAA,QAAAgC,EAAA,QACAhC,EAAA,MAAA,GAAAgC,EAAA,UACAhC,EAAA,MAAA,WAAAgC,EAAA,WACArC,EAAA,QACEA,EAAA,MAAA,WAAAqC,EAAA,WACArC,EAAA,MAAA,kBAAAqC,EAAA,kBAAqErC,EAAA,MAAA,gBAAAqC,EAAA,iBACrEpC,EAAA,QAAAD,EAAA,MAAA,kBACEC,EAAA,MAAAD,EAAA,MAAA,kBAGJJ,EAAA,MAAA,IAAiByC,EAAA,OAAA,UAEjBhC,EAAA,MAAA,QAAA,GAAAlF,EAAAkH,EAAA,GAAA,MAAAA,EAAA,WACA,QAAA,MAAAA,EAAA,IAAAA,EAAA,OAAA,EACAA,EAAA,UACEJ,EAAAI,EAAA,UAGJhH,EAAA,OAAyBoG,KAAe,EAG1CS,EAAA,QAAA,MAAAE,GAAA,CAKE,GAJArC,EAAA,KACAH,EAAA,MAAA,GACAS,EAAA,MAAA,OAAA,GACA,QAAA,IAAA,iCAAA+B,EAAAzC,EAAA,KAAA,EACAA,EAAA,OAAAyC,EAAA,OAAA,KAEE,GAAAR,EACE,GAAA5B,EAAA,MAAA,CAEE,MAAAjB,EAAA,IAAA,KAAAiB,EAAA,MAAA,WAAA,EAAA,QAAA,EAAA,IACAsC,GAAA,CAAsB,GAAArC,EAAA,MACM,MAAAD,EAAA,MAAA,MACI,WAAAA,EAAA,MAAA,WACK,YAAAjB,EACnC,QAAA,CAAA,EACU,aAAA,IACI,EAEhBvC,EAAA,OAAA,CAAyB,sBAAA,CACA,CAAAwD,EAAA,MAAA,eAAA,EAAAsC,EACqB,CAC5C,CAAA,EAEF,MAAAC,GAAAnC,EAAA,MACAoC,GAAAnC,EAAA,MACAD,EAAA,MAAA,KACAC,EAAA,MAAA,KACA7D,EAAA,yBAAAyD,EAAA,MAAAsC,GAAAC,EAAA,EACAvC,EAAA,MAAAD,EAAA,MAAA,gBACA,MAAAxD,EAAA,wBACAwD,EAAA,MAAA,KACA,QAAA,IAAA,OAAAsC,GAAAC,GAAAC,GAAAvC,EAAA,KAAA,CAAgF,MAGhFI,EAAA,MAAA,GAAA,WAAA,MAAA,GAEE7D,EAAA,yBAAAyD,EAAA,MAAAG,EAAA,MAAAC,EAAA,KAAA,EAEFD,EAAA,MAAA,KACAC,EAAA,MAAA,UAIJ3C,GAAA,MAAA,CAAa,MAAAvC,EAAA,iBAAA,EACe,QAAA8G,GAAA,KAAA,IAAAG,EAAA,SAAAjH,EAAAiH,EAAA,MAAA,MAAAH,IAAA,IAAAG,EAAA,SAAAjH,EAAAiH,EAAA,MAAA,IACmG,aAAAjH,EAAA,yBAAA,EACpF,aAAAA,EAAA,gBAAA,EACT,gBAAA,IAAA,CAE9BiF,EAAA,MAAA,KACAC,EAAA,MAAA,IAAiC,CACnC,CAAA,EAGJ,MAAAd,EAAA,gBACA2B,EAAA,OAAA,EACAzB,EAAA,MAAA,GACAE,EAAA,MAAA,EAAkB,EAGpBuC,EAAA,QAAAE,GAAA,CACE,QAAA,MAAA,mBAAAA,CAAA,CAAuC,EAGzCrC,EAAA,IAAA,CACEJ,EAAA,MAAA,GACAuC,EAAA,MAAA,CAAgB,CAClB,EAGFO,GAAA,IAAA,CACE,GAAA,CAAAvC,EAAA,MAAA,CACEtC,EAAA,MAAAzC,EAAA,+BAAA,CAAA,EACA,MAAA,CAEFwD,GAAAuB,EAAA,MAAAI,EAAA,KAAA,CAAyE,EAG3EoC,EAAA/G,IACAgH,GAAAhH,EAAA,EAAA,EAEAiH,GAAA,IAAA,CACE,GAAA,CAAA1C,EAAA,MAAA,CACEtC,EAAA,MAAAzC,EAAA,+BAAA,CAAA,EACA,MAAA,CAGFuH,EAAA,MAAA,QACAA,EAAA,MAAA,wBAAA,EAAA,CAAoD,EAGtDG,GAAA,IAAA,CACE,GAAA,CAAA3C,EAAA,MAAA,CACEtC,EAAA,MAAAzC,EAAA,+BAAA,CAAA,EACA,MAAA,CAEFuH,EAAA,MAAA,wBAAA,EAAA,EACA,OAAA,MAAA,EACAA,EAAA,MAAA,wBAAA,EAAA,CAAqD,EAIvD,OAAAlG,EAAA,wBAAA"}