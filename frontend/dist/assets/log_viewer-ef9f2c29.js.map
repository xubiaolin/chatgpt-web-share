{"version":3,"file":"log_viewer-ef9f2c29.js","sources":["../../src/views/admin/log_viewer.vue"],"sourcesContent":["<template>\n  <div class=\"mb-4 flex flex-col\">\n    <n-tabs\n      v-model:value=\"tab\"\n      type=\"segment\"\n    >\n      <n-tab name=\"server\">\n        {{ t('commons.serverLogs') }}\n      </n-tab>\n      <!-- <n-tab name=\"proxy\">\n        {{ t('commons.proxyLogs') }}\n      </n-tab> -->\n    </n-tabs>\n    <!-- 设置 -->\n    <div class=\"flex flex-row mt-3 justify-between\">\n      <div class=\"flex flex-wrap flex-row sm:space-x-3\">\n        <div class=\"option-item\">\n          <n-text>{{ t('commons.maxLineCount') }}</n-text>\n          <n-input-number\n            v-model:value=\"maxLineCount\"\n            size=\"small\"\n            class=\"w-27\"\n            :min=\"100\"\n            :max=\"2000\"\n            :step=\"100\"\n          />\n        </div>\n        <div class=\"option-item\">\n          <n-text>{{ t('commons.updateInterval') }}</n-text>\n          <n-select\n            v-model:value=\"refresh_duration\"\n            size=\"small\"\n            class=\"w-20\"\n            :options=\"[\n              { label: '3s', value: 3 },\n              { label: '5s', value: 5 },\n              { label: '10s', value: 10 },\n            ]\"\n          />\n        </div>\n        <div class=\"option-item\">\n          <n-text>{{ t('commons.excludeKeywords') }}</n-text>\n          <n-dynamic-tags\n            v-if=\"tab === 'proxy'\"\n            v-model:value=\"proxyExcludeKeywords\"\n            size=\"small\"\n          />\n          <n-dynamic-tags\n            v-else\n            v-model:value=\"serverExcludeKeywords\"\n            size=\"small\"\n          />\n        </div>\n      </div>\n      <div class=\"flex items-center space-x-2\">\n        <n-text>{{ t('commons.autoScrolling') }}</n-text>\n        <n-switch\n          v-model:value=\"enableAutoScroll\"\n          size=\"small\"\n        />\n      </div>\n    </div>\n    <n-card\n      class=\"mt-3 flex-grow h-full\"\n      :content-style=\"{ height: '100%' }\"\n    >\n      <n-log\n        ref=\"logInstRef\"\n        :font-size=\"10\"\n        :rows=\"40\"\n        :lines=\"logsContent\"\n      />\n    </n-card>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { nextTick, ref, watch } from 'vue';\nimport { useI18n } from 'vue-i18n';\n\nimport { getProxyLogsApi, getServerLogsApi } from '@/api/system';\nimport { LogFilterOptions } from '@/types/schema';\nconst { t } = useI18n();\n\nconst refresh_duration = ref(5);\nconst tab = ref<string>('server');\nconst logsContent = ref<Array<string>>();\nconst enableAutoScroll = ref(true);\nconst maxLineCount = ref(100);\nconst proxyExcludeKeywords = ref<Array<string>>([]);\nconst serverExcludeKeywords = ref<Array<string>>(['status', 'logs']);\n\nconst logInstRef = ref();\n\nwatch(\n  () => tab.value,\n  () => {\n    loadLogs();\n  }\n);\nwatch(\n  () => maxLineCount.value,\n  () => {\n    loadLogs();\n  }\n);\n\nconst scrollToBottom = () => {\n  nextTick(() => {\n    logInstRef.value?.scrollTo({ position: 'bottom', slient: false });\n  });\n};\n\nconst loadLogs = () => {\n  if (tab.value === 'server') {\n    getServerLogsApi({\n      max_lines: maxLineCount.value,\n      exclude_keywords: serverExcludeKeywords.value,\n    } as LogFilterOptions).then((res) => {\n      logsContent.value = res.data;\n    });\n  } else {\n    getProxyLogsApi({\n      max_lines: maxLineCount.value,\n      exclude_keywords: proxyExcludeKeywords.value,\n    } as LogFilterOptions).then((res) => {\n      logsContent.value = res.data;\n    });\n  }\n  if (enableAutoScroll.value) {\n    scrollToBottom();\n  }\n};\n\nloadLogs();\nlet interval = setInterval(() => {\n  loadLogs();\n}, refresh_duration.value * 1000);\n\nwatch(\n  () => refresh_duration.value,\n  () => {\n    clearInterval(interval);\n    interval = setInterval(() => {\n      loadLogs();\n    }, refresh_duration.value * 1000);\n  }\n);\n\nwatch(\n  () => serverExcludeKeywords.value,\n  () => {\n    loadLogs();\n  }\n);\n\nwatch(\n  () => proxyExcludeKeywords.value,\n  () => {\n    loadLogs();\n  }\n);\n</script>\n\n<style>\n.option-item {\n  @apply flex flex-row space-x-2 items-center mr-1 my-1;\n}\n</style>\n"],"names":["t","useI18n","refresh_duration","ref","tab","logsContent","enableAutoScroll","maxLineCount","proxyExcludeKeywords","serverExcludeKeywords","logInstRef","watch","loadLogs","scrollToBottom","nextTick","_a","getServerLogsApi","res","getProxyLogsApi","interval"],"mappings":"skBAkFA,KAAA,CAAA,EAAAA,GAAAC,IAEAC,EAAAC,EAAA,CAAA,EACAC,EAAAD,EAAA,QAAA,EACAE,EAAAF,IACAG,EAAAH,EAAA,EAAA,EACAI,EAAAJ,EAAA,GAAA,EACAK,EAAAL,EAAA,CAAA,CAAA,EACAM,EAAAN,EAAA,CAAA,SAAA,MAAA,CAAA,EAEAO,EAAAP,IAEAQ,EAAA,IAAAP,EAAA,MACY,IAAA,CAERQ,GAAS,CACX,EAEFD,EAAA,IAAAJ,EAAA,MACqB,IAAA,CAEjBK,GAAS,CACX,EAGF,MAAAC,EAAA,IAAA,CACEC,EAAA,IAAA,QACEC,EAAAL,EAAA,QAAA,MAAAK,EAAA,SAAA,CAAA,SAAA,SAAA,OAAA,EAAA,EAAgE,CAAA,CACjE,EAGHH,EAAA,IAAA,CACER,EAAA,QAAA,SACEY,EAAA,CAAiB,UAAAT,EAAA,MACS,iBAAAE,EAAA,KACgB,CAAA,EAAA,KAAAQ,GAAA,CAExCZ,EAAA,MAAAY,EAAA,IAAwB,CAAA,EAG1BC,EAAA,CAAgB,UAAAX,EAAA,MACU,iBAAAC,EAAA,KACe,CAAA,EAAA,KAAAS,GAAA,CAEvCZ,EAAA,MAAAY,EAAA,IAAwB,CAAA,EAG5BX,EAAA,OACEO,GACF,EAGFD,IACA,IAAAO,EAAA,YAAA,IAAA,CACEP,GAAS,EAAAV,EAAA,MAAA,GAAA,EAGX,OAAAS,EAAA,IAAAT,EAAA,MACyB,IAAA,CAErB,cAAAiB,CAAA,EACAA,EAAA,YAAA,IAAA,CACEP,GAAS,EAAAV,EAAA,MAAA,GAAA,CACqB,CAClC,EAGFS,EAAA,IAAAF,EAAA,MAC8B,IAAA,CAE1BG,GAAS,CACX,EAGFD,EAAA,IAAAH,EAAA,MAC6B,IAAA,CAEzBI,GAAS,CACX"}